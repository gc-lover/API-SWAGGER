# Инструкция для AI создателя заданий

**Цель:** Создавать полные задания для агентов-исполнителей на основе документов из .BRAIN.

**Минимальный вход:**
1. ПРАВИЛО: `API-SWAGGER/.cursor/rules/api-task-creator-rules.mdc`
2. ИНСТРУКЦИЯ: Этот файл
3. ДОКУМЕНТ из .BRAIN: Путь к файлу с фичей для проработки

---

## Процесс работы

### Шаг 1: Анализ входных данных

**Что нужно сделать:**
1. Прочитай правило (`api-task-creator-rules.mdc`) - пойми свою роль и задачи
2. Прочитай этот файл (инструкцию) - пойми процесс работы
3. Прочитай документ из .BRAIN полностью - извлеки всю информацию

**Что важно понять из документа .BRAIN:**
- Концепции и механики, которые нужно отразить в API
- Бизнес-правила и ограничения
- Связанные документы и зависимости
- Примеры и вдохновение из источников
- Детали реализации (если есть)

---

### Шаг 2: Определение целевой структуры API

**Что нужно определить:**
1. Какой модуль/раздел API нужен? (gameplay, lore, narrative, social и т.д.)
2. Какая версия API? (v1, v2 и т.д.)
3. Какой путь к файлу? (api/v1/gameplay/combat/shooting.yaml и т.д.)
4. Какое имя файла? (основано на содержимом документа)

**Правила именования:**
- Файлы: kebab-case (shooting.yaml, combat-mechanics.yaml)
- Директории: kebab-case (gameplay, combat)
- Модели в API: PascalCase (Weapon, Shot)
- Endpoints: kebab-case (/gameplay/combat/shoot)

**Структура директорий:**
```
api/v1/
├── gameplay/
│   ├── combat/
│   ├── progression/
│   ├── economy/
│   ├── social/
│   └── world/
├── lore/
│   ├── factions/
│   ├── locations/
│   └── characters/
└── narrative/
    └── quests/
```

---

### Шаг 3: Извлечение информации для задания

**Из документа .BRAIN нужно извлечь:**

1. **Концепции и механики:**
   - Основные концепции, которые нужно отразить в API
   - Механики игрового процесса
   - Правила и ограничения

2. **Endpoints (если можно определить):**
   - Какие действия нужно выполнять?
   - Какие данные нужно получать/изменять?
   - Какие операции нужны?

3. **Модели данных:**
   - Какие сущности упоминаются?
   - Какие свойства у этих сущностей?
   - Какие связи между сущностями?

4. **Бизнес-правила:**
   - Валидация данных
   - Ограничения использования
   - Условия применения

5. **Связанные документы:**
   - Документы, на которые ссылается текущий
   - Документы, которые зависят от текущего
   - Связанные концепции

**Если информации недостаточно:**
- Используй принципы проекта (SOLID, DRY, KISS)
- Используй стандарты OpenAPI 3.0.3
- Используй примеры из существующих API (если есть)
- Создай логичную структуру на основе концепций

---

### Шаг 4: Создание задания по шаблону

**Используй шаблон:** `tasks/templates/api-generation-task-template.md`

**Заполни все секции:**

1. **Метаданные:**
   - Task ID: API-TASK-XXX (уникальный номер)
   - Тип: API Generation
   - Приоритет: на основе важности фичи
   - Статус: queued
   - Зависимости: другие задания (если есть)

2. **Источники:**
   - Путь к документу .BRAIN
   - Версия документа (если есть)
   - Статус документа (draft, review, approved)
   - Связанные документы

3. **Целевая структура:**
   - Полный путь к файлу API
   - Версия API
   - Структура директории

4. **Детальный план:**
   - Шаг 1: Анализ исходного документа
   - Шаг 2: Определение API endpoints
   - Шаг 3: Определение моделей данных
   - Шаг 4: Создание OpenAPI спецификации
   - Шаг 5: Валидация и проверка

5. **Endpoints:**
   - Для каждого endpoint: метод, путь, назначение, параметры, ответы, примеры

6. **Модели данных:**
   - Для каждой модели: все поля, типы, валидация, примеры

7. **Принципы и правила:**
   - Принципы проекта (SOLID, DRY, KISS)
   - Стандарты OpenAPI
   - Правила из workspace rules

8. **Критерии приемки:**
   - Чеклист из 10+ пунктов
   - Каждый пункт проверяемый и измеримый

9. **FAQ:**
   - Ответы на типичные вопросы
   - Разрешение возможных проблем

---

### Шаг 5: Проверка по чеклисту

**Используй чеклист:** `tasks/config/checklist.md`

**Проверь:**
- Все обязательные секции заполнены
- Все блоки детализированы
- Задание самодостаточно
- Ссылки на документы корректны
- Примеры включены
- Критерии приемки измеримы

---

### Шаг 6: Сохранение задания

**Сохрани задание:**
- Путь: `tasks/active/queue/task-XXX-description.md`
- Имя файла: на основе описания задания
- Формат: Markdown

**Пример имени:**
- `task-001-shooting-api.md`
- `task-002-combat-abilities-api.md`
- `task-003-progression-api.md`

---

### Шаг 7: Обновление маппинга

**Обнови:** `tasks/config/brain-mapping.yaml`

**Добавь запись:**
```yaml
mappings:
  - source: ".BRAIN/02-gameplay/combat/shooter-mechanics.md"
    target: "api/v1/gameplay/combat/shooting.yaml"
    task_id: "API-TASK-001"
    task_file: "tasks/active/queue/task-001-shooting-api.md"
    status: "queued"
    created: "2025-11-02 15:30"
    version: "v1.0.0"
```

---

### Шаг 8: Обновление документа .BRAIN

**Добавь секцию в начало или конец документа .BRAIN:**

```markdown
---
**API Tasks Status:**
- Status: created
- Tasks:
  - API-TASK-001: api/v1/gameplay/combat/shooting.yaml (2025-11-02)
- Last Updated: 2025-11-02 15:30
---
```

**Или в конец документа:**

```markdown
---

## API Tasks

**Status:** created
**Tasks:**
- [API-TASK-001](../API-SWAGGER/tasks/active/queue/task-001-shooting-api.md): api/v1/gameplay/combat/shooting.yaml
**Last Updated:** 2025-11-02 15:30
```

---

## Быстрый шаблон для создания задания

Если нужно быстро создать задание:

1. Прочитай документ .BRAIN
2. Определи: что нужно в API? (endpoints, модели)
3. Определи путь: `api/v1/.../filename.yaml`
4. Создай задание по шаблону с заполнением всех секций
5. Проверь по чеклисту
6. Сохрани в `tasks/active/queue/`
7. Обнови маппинг и документ .BRAIN

---

## Примеры хороших заданий

**Хорошее задание:**
- Детальное описание всех шагов
- Все endpoints описаны с примерами
- Все модели описаны с валидацией
- Критерии приемки измеримые
- FAQ отвечает на типичные вопросы

**Плохое задание:**
- Неполное описание
- Нет примеров
- Неясные критерии приемки
- Пропущены важные детали

---

## Частые ошибки

1. **Недостаточно деталей** - задание должно быть самодостаточным
2. **Нет примеров** - агент-исполнитель нуждается в примерах
3. **Неясные критерии** - критерии должны быть измеримыми
4. **Пропущены зависимости** - нужно указывать все зависимости
5. **Не обновлен маппинг** - обязательно обновлять brain-mapping.yaml

---

## Полезные ссылки

- [Шаблон задания](../templates/api-generation-task-template.md)
- [Чеклист проверки](./checklist.md)
- [Правила работы](../../.cursor/rules/api-task-creator-rules.mdc)
- [Маппинг .BRAIN -> задания](./brain-mapping.yaml)
- [OpenAPI Specification](https://swagger.io/specification/)
