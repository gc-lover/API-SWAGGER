# Task ID: API-TASK-126
**–¢–∏–ø:** API Generation
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π
**–°—Ç–∞—Ç—É—Å:** queued
**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-07 10:00
**–°–æ–∑–¥–∞—Ç–µ–ª—å:** AI Agent (API Task Creator)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** none

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**MVP –ë–õ–û–ö–ï–†!** –°–æ–∑–¥–∞—Ç—å API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ë–ï–ó –≠–¢–û–ô –°–ò–°–¢–ï–ú–´ –ò–ì–†–ê –ù–ï –ú–û–ñ–ï–¢ –ó–ê–ü–£–°–¢–ò–¢–¨–°–Ø.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:** –°–æ–∑–¥–∞—Ç—å OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è Authentication & Authorization System –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑ .BRAIN.

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω—ã–π REST API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–æ–≤, –≤–∫–ª—é—á–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –≤—Ö–æ–¥, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏, OAuth –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é, 2FA –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏.

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- –ë–ï–ó –≠–¢–û–ì–û –ò–ì–†–ê –ù–ï –ó–ê–ü–£–°–¢–ò–¢–°–Ø (MVP –±–ª–æ–∫–µ—Ä)
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∏–≥—Ä–æ–∫–æ–≤ –∫ –∏–≥—Ä–µ
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ (player, moderator, admin)
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Session Management System

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `.BRAIN`
**–ü—É—Ç—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É:** `.BRAIN/05-technical/backend/authentication-authorization-system.md`
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** v1.0.0
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-07 05:20
**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** approved
**API Readiness:** ready

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞:**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (email/password + OAuth)
- Login/Logout flow —Å JWT tokens
- Access token (15 min) + Refresh token (7 days)
- Password recovery —á–µ—Ä–µ–∑ email
- Two-Factor Authentication (TOTP)
- Roles & Permissions (PLAYER, MODERATOR, ADMIN, SUPER_ADMIN)
- Account linking (Steam, Google, Discord)
- Brute force protection
- Token blacklist –¥–ª—è logout

### Database Schema (–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)

**–¢–∞–±–ª–∏—Ü—ã:**
1. `accounts` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
2. `account_roles` - —Ä–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞
3. `password_reset_tokens` - —Ç–æ–∫–µ–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
4. `email_verification_tokens` - —Ç–æ–∫–µ–Ω—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email
5. `login_history` - –∏—Å—Ç–æ—Ä–∏—è –≤—Ö–æ–¥–æ–≤

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `.BRAIN/05-technical/backend/session-management-system.md` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –ø–æ—Å–ª–µ login

---

## üìÅ –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API

### –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `API-SWAGGER`

**–¶–µ–ª–µ–≤–æ–π —Ñ–∞–π–ª:** `api/v1/auth/authentication.yaml`
**API –≤–µ—Ä—Å–∏—è:** v1
**–¢–∏–ø —Ñ–∞–π–ª–∞:** OpenAPI 3.0 Specification (YAML)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
```
API-SWAGGER/
‚îî‚îÄ‚îÄ api/
    ‚îî‚îÄ‚îÄ v1/
        ‚îî‚îÄ‚îÄ auth/
            ‚îú‚îÄ‚îÄ authentication.yaml  ‚Üê –°–æ–∑–¥–∞—Ç—å
            ‚îú‚îÄ‚îÄ authorization.yaml   ‚Üê –°–æ–∑–¥–∞—Ç—å
            ‚îú‚îÄ‚îÄ oauth.yaml           ‚Üê –°–æ–∑–¥–∞—Ç—å
            ‚îî‚îÄ‚îÄ tokens.yaml          ‚Üê –°–æ–∑–¥–∞—Ç—å
```

**–†–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ —Ñ–∞–π–ª–∞–º (–Ω–µ –±–æ–ª–µ–µ 400 —Å—Ç—Ä–æ–∫ –∫–∞–∂–¥—ã–π):**
1. `authentication.yaml` - register, login, logout, password recovery
2. `authorization.yaml` - roles, permissions, check access
3. `oauth.yaml` - OAuth providers integration
4. `tokens.yaml` - refresh token, verify token, blacklist

---

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å):

**–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å:** auth-service  
**–ü–æ—Ä—Ç:** 8081  
**API –ø—É—Ç–∏:** /api/v1/auth/*

### OpenAPI (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

- –ó–∞–ø–æ–ª–Ω–∏ `info.x-microservice` (name, port, domain, base-path, package) –ø–æ –¥–∞–Ω–Ω—ã–º —Ü–µ–ª–µ–≤–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞.
- –í —Å–µ–∫—Ü–∏–∏ `servers` –æ—Å—Ç–∞–≤—å Production gateway `https://api.necp.game/v1` –∏ –ø—Ä–∏–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ `http://localhost:8080/api/v1`.
- WebSocket –º–∞—Ä—à—Ä—É—Ç—ã –ø—É–±–ª–∏–∫—É–π —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `wss://api.necp.game/v1/...`.

### Frontend (–º–æ–¥—É–ª—å):

**–ú–æ–¥—É–ª—å:** N/A (—ç—Ç–æ –±–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –Ω–µ –∏–≥—Ä–æ–≤–æ–π –º–æ–¥—É–ª—å)  
**–ü—É—Ç—å:** src/features/auth/  
**State Store:** useAuthStore (currentUser, tokens, loginStatus)

### Frontend (–±–∏–±–ª–∏–æ—Ç–µ–∫–∏):

**UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (@shared/ui):**
- Button, Input, Card, Checkbox

**–ì–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ä–º—ã (@shared/forms):**
- LoginForm, RegistrationForm, PasswordResetForm, TwoFactorForm

**Layouts (@shared/layouts):**
- AuthLayout (—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –±–µ–∑ game navigation)

**–•—É–∫–∏ (@shared/hooks):**
- useDebounce (–¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email)
- useLocalStorage (–¥–ª—è remember me)

---

## ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å authentication.yaml

**Endpoints:**

1. **POST /api/v1/auth/register**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
   - Body: email, password, username
   - Response: account_id, access_token, refresh_token
   - Errors: 400 (validation), 409 (email exists)

2. **POST /api/v1/auth/login**
   - –í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç
   - Body: email, password, (optional) two_factor_code
   - Response: access_token, refresh_token, expires_in
   - Errors: 401 (invalid credentials), 423 (account locked)

3. **POST /api/v1/auth/logout**
   - –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
   - Body: refresh_token
   - Action: –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ blacklist
   - Response: 204 No Content

4. **POST /api/v1/auth/password/forgot**
   - –ó–∞–ø—Ä–æ—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
   - Body: email
   - Action: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email —Å —Ç–æ–∫–µ–Ω–æ–º
   - Response: 200 OK (–≤—Å–µ–≥–¥–∞, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

5. **POST /api/v1/auth/password/reset**
   - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É
   - Body: reset_token, new_password
   - Response: 200 OK
   - Errors: 400 (invalid/expired token)

6. **POST /api/v1/auth/email/verify**
   - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–∞
   - Body: verification_token
   - Response: 200 OK

7. **POST /api/v1/auth/email/resend**
   - –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ verification email
   - Body: email
   - Response: 200 OK

**Models:**
- RegisterRequest (email, password, username)
- LoginRequest (email, password, two_factor_code?)
- LoginResponse (access_token, refresh_token, expires_in, token_type)
- PasswordForgotRequest (email)
- PasswordResetRequest (reset_token, new_password)
- EmailVerifyRequest (verification_token)

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å authorization.yaml

**Endpoints:**

1. **GET /api/v1/auth/me**
   - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
   - Headers: Authorization: Bearer <access_token>
   - Response: UserProfile (id, email, username, roles, permissions)

2. **POST /api/v1/auth/roles/assign**
   - –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (admin only)
   - Body: account_id, role, permissions[]
   - Response: 200 OK

3. **DELETE /api/v1/auth/roles/revoke**
   - –û—Ç–æ–∑–≤–∞—Ç—å —Ä–æ–ª—å (admin only)
   - Body: account_id, role
   - Response: 204 No Content

4. **POST /api/v1/auth/permissions/check**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
   - Body: account_id, permission
   - Response: {has_permission: true/false}

**Models:**
- UserProfile (id, email, username, display_name, roles[], permissions[], created_at)
- RoleAssignRequest (account_id, role, permissions[]?, granted_until?)
- RoleRevokeRequest (account_id, role)
- PermissionCheckRequest (account_id, permission)
- PermissionCheckResponse (has_permission)

### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å oauth.yaml

**Endpoints:**

1. **GET /api/v1/auth/oauth/{provider}/authorize**
   - –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å OAuth flow
   - Params: provider (google, steam, discord, twitch)
   - Response: redirect_url

2. **POST /api/v1/auth/oauth/{provider}/callback**
   - OAuth callback –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - Body: code, state
   - Response: access_token, refresh_token (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ login)

3. **POST /api/v1/auth/oauth/link**
   - –ü—Ä–∏–≤—è–∑–∞—Ç—å OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É
   - Body: provider, oauth_token
   - Response: 200 OK

4. **DELETE /api/v1/auth/oauth/unlink**
   - –û—Ç–≤—è–∑–∞—Ç—å OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
   - Body: provider
   - Response: 204 No Content

**Models:**
- OAuthAuthorizeResponse (redirect_url, state)
- OAuthCallbackRequest (code, state)
- OAuthLinkRequest (provider, oauth_token)

### –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å tokens.yaml

**Endpoints:**

1. **POST /api/v1/auth/token/refresh**
   - –û–±–Ω–æ–≤–∏—Ç—å access token –∏—Å–ø–æ–ª—å–∑—É—è refresh token
   - Body: refresh_token
   - Response: new access_token, new refresh_token
   - Errors: 401 (invalid/expired refresh token)

2. **POST /api/v1/auth/token/verify**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞
   - Body: token
   - Response: {valid: true/false, expires_at, account_id}

3. **POST /api/v1/auth/token/revoke**
   - –û—Ç–æ–∑–≤–∞—Ç—å refresh token (–¥–æ–±–∞–≤–∏—Ç—å –≤ blacklist)
   - Body: refresh_token
   - Response: 204 No Content

4. **POST /api/v1/auth/token/revoke-all**
   - –û—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ refresh tokens –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - Response: 204 No Content (logout everywhere)

**Models:**
- TokenRefreshRequest (refresh_token)
- TokenRefreshResponse (access_token, refresh_token, expires_in)
- TokenVerifyRequest (token)
- TokenVerifyResponse (valid, expires_at, account_id, roles[])
- TokenRevokeRequest (refresh_token)

### –®–∞–≥ 5: –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**Security Schemas (–∏—Å–ø–æ–ª—å–∑—É–π $ref –∏–∑ shared/common/security.yaml):**
- BearerAuth - JWT token –≤ Authorization header

**Error Responses (–∏—Å–ø–æ–ª—å–∑—É–π $ref –∏–∑ shared/common/responses.yaml):**
- 400 Bad Request (VAL_INVALID_INPUT)
- 401 Unauthorized (AUTH_INVALID_CREDENTIALS, AUTH_TOKEN_EXPIRED)
- 403 Forbidden (AUTH_INSUFFICIENT_PERMISSIONS)
- 409 Conflict (BIZ_EMAIL_EXISTS, BIZ_USERNAME_EXISTS)
- 423 Locked (AUTH_ACCOUNT_LOCKED)
- 500 Internal Server Error (INT_DATABASE_ERROR)

---

## üîç –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

1. ‚úÖ –í—Å–µ 4 —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω—ã (authentication, authorization, oauth, tokens)
2. ‚úÖ –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 400 —Å—Ç—Ä–æ–∫
3. ‚úÖ –í—Å–µ endpoints –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ shared/common/ —á–µ—Ä–µ–∑ $ref
5. ‚úÖ –í—Å–µ models —Å–æ–¥–µ—Ä–∂–∞—Ç validation rules (required, minLength, pattern)
6. ‚úÖ Security schemas –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ –≤—Å–µ–º –∑–∞—â–∏—â–µ–Ω–Ω—ã–º endpoints
7. ‚úÖ Error responses —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç ErrorCode enum)
8. ‚úÖ JWT tokens –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (access 15min, refresh 7days)
9. ‚úÖ Rate limiting —É–∫–∞–∑–∞–Ω –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints (login, register)
10. ‚úÖ –ï—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö endpoints (request + response)
11. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ OAuth flow
12. ‚úÖ –£–∫–∞–∑–∞–Ω—ã —Å–≤—è–∑–∏ —Å Session Management System
13. ‚úÖ Brute force protection –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
14. ‚úÖ 2FA flow –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
15. ‚úÖ OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞ (–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Swagger Editor)

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### JWT Token Structure

```json
{
  "sub": "account_id",
  "email": "user@example.com",
  "roles": ["PLAYER"],
  "permissions": [],
  "iat": 1699564800,
  "exp": 1699565700,
  "type": "access"
}
```

### Roles Hierarchy

- PLAYER - –±–∞–∑–æ–≤–∞—è —Ä–æ–ª—å (default)
- CONTENT_CREATOR - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- TESTER - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏—á
- MODERATOR - –º–æ–¥–µ—Ä–∞—Ü–∏—è —á–∞—Ç–∞, –∏–≥—Ä–æ–∫–æ–≤
- ADMIN - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–º
- SUPER_ADMIN - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø

### OAuth Providers

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:
- Google (`google`)
- Steam (`steam`)
- Discord (`discord`)
- Twitch (`twitch`)

### Rate Limiting

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ endpoints:**
- `/auth/register` - 3 requests / 15min per IP
- `/auth/login` - 5 requests / 5min per IP
- `/auth/password/forgot` - 3 requests / 15min per IP

---

## ‚ùì FAQ

**Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –ø–∞—Ä–æ–ª—å?**
A: Flow: POST /password/forgot ‚Üí email —Å —Ç–æ–∫–µ–Ω–æ–º ‚Üí POST /password/reset —Å —Ç–æ–∫–µ–Ω–æ–º –∏ –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

**Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç 2FA?**
A: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ login —Å 2FA –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–≤–µ—Å—Ç–∏ TOTP –∫–æ–¥. Login endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º 2FA –∫–æ–¥–∞.

**Q: –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è refresh tokens?**
A: –í Redis —Å TTL 7 –¥–Ω–µ–π. –ü—Ä–∏ logout —Ç–æ–∫–µ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ blacklist.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ?**
A: –î–∞, –º–æ–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ (–æ–¥–∏–Ω email + Google + Steam + Discord).

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ logout?**
A: Refresh token –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ blacklist (Redis), access token –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.

**Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω?**
A: API Gateway –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å, expiration, –∏ —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –≤ blacklist.

---

## üîó –°–≤—è–∑–∏

**Backend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Session Management System - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ login
- Database - PostgreSQL (accounts, roles, tokens)
- Redis - refresh tokens storage, blacklist, rate limiting
- Email Service - –æ—Ç–ø—Ä–∞–≤–∫–∞ verification –∏ password reset emails

**Frontend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- Registration Page - —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- Login Page - —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
- OAuth Flow - —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –¥–ª—è OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- 2FA Page - –≤–≤–æ–¥ TOTP –∫–æ–¥–∞

---

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `.BRAIN/05-technical/backend/authentication-authorization-system.md`

