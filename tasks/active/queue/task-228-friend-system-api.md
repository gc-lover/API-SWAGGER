# Task ID: API-TASK-228
**–¢–∏–ø:** API Generation
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –≤—ã—Å–æ–∫–∏–π
**–°—Ç–∞—Ç—É—Å:** queued
**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-08 04:40
**–°–æ–∑–¥–∞—Ç–µ–ª—å:** GPT-5 Codex (API Task Creator)
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** API-TASK-211, API-TASK-219, API-TASK-224

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é API —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥—Ä—É–∑–µ–π: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞–º–∏, —Å–ø–∏—Å–∫–æ–º –¥—Ä—É–∑–µ–π, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º, –∏–≥–Ω–æ—Ä–æ–º –∏ recent players.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:** –°–æ–∑–¥–∞—Ç—å `api/v1/social/friends/friend-system.yaml`, –æ–ø–∏—Å–∞–≤ REST/WS –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø–æ `.BRAIN/05-technical/backend/friend-system.md`.

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è

–û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–¥—ë–∂–Ω—É—é —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–æ–≤.

**–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:**
- –£–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–∂–µ—Å–∫–∏–º–∏ —Å–≤—è–∑—è–º–∏, –∑–∞—è–≤–∫–∞–º–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ, —Å—Ç–∞—Ç—É—Å—ã, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å cross-platform invites, recent players
- –î–∞—Ç—å –¥–∞–Ω–Ω—ã–µ UI –º–æ–¥—É–ª—è–º –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å notification –∏ realtime

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç

**–ü—É—Ç—å:** `.BRAIN/05-technical/backend/friend-system.md`
**–í–µ—Ä—Å–∏—è:** v1.0.0 (2025-11-07)
**–°—Ç–∞—Ç—É—Å:** approved, api-readiness: ready

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
- Friend list lifecycle (add, confirm, remove)
- Requests, invitations, throttling
- Presence/online status, platforms, activities
- Ignore/block list, privacy —É—Ä–æ–≤–Ω–∏
- Recent players, suggestions, social graph

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

- `.BRAIN/05-technical/backend/notification-system.md`
- `.BRAIN/05-technical/backend/session-management/README.md`
- `.BRAIN/05-technical/backend/leaderboard-system.md`
- `.BRAIN/05-technical/backend/guild-system-backend.md`
- `.BRAIN/05-technical/backend/social-presence.md` *(–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)*

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `API-SWAGGER/tasks/active/queue/task-211-leaderboards-ui-api.md`
- `API-SWAGGER/tasks/active/queue/task-219-achievement-tracking-api.md`
- `API-SWAGGER/tasks/active/queue/task-224-progression-backend-api.md`

---

## üìÅ –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API

- **–§–∞–π–ª:** `api/v1/social/friends/friend-system.yaml`
- **–í–µ—Ä—Å–∏—è API:** v1
- **–§–æ—Ä–º–∞—Ç:** OpenAPI 3.0.3

```
API-SWAGGER/api/v1/social/friends/
 ‚îú‚îÄ‚îÄ friend-system.yaml     ‚Üê —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å
 ‚îú‚îÄ‚îÄ friend-components.yaml
 ‚îî‚îÄ‚îÄ friend-examples.yaml
```

---

## üèóÔ∏è –¶–µ–ª–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)

### Backend
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å:** social-service (friends module)
- **–ü–æ—Ä—Ç:** 8090
- **API Base Path:** `/api/v1/social/friends`
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
  - auth-service ‚Äì –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
  - session-service ‚Äì presence, last activity, game session invites
  - notification-service ‚Äì push, inbox —Å–æ–æ–±—â–µ–Ω–∏—è
  - realtime-service ‚Äì WebSocket presence updates
  - analytics-service ‚Äì –º–µ—Ç—Ä–∏–∫–∏ social interactions
  - moderation-service ‚Äì –æ—Ç—á—ë—Ç—ã –Ω–∞ –∏–≥—Ä–æ–∫–æ–≤, auto-block

### Frontend
- **–ú–æ–¥—É–ª—å:** `modules/social/friends`
- **State Store:** `useFriendsStore`
- **State:** `friends`, `requests`, `incoming`, `presence`, `blocks`, `recent`
- **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** `FriendsList`, `FriendRequestsPanel`, `PresenceIndicator`, `BlockList`, `RecentPlayers`, `InviteFriendModal`
- **–§–æ—Ä–º—ã:** `FriendSearchForm`, `SendRequestForm`, `InviteToPartyForm`
- **–•—É–∫–∏:** `useFriends`, `usePresence`, `useFriendRequests`, `useFriendInvites`

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è YAML

```yaml
# Target Architecture:
# - Microservice: social-service (port 8090)
# - API Base: /api/v1/social/friends
# - Dependencies: auth, session, notification, realtime, analytics, moderation
# - Frontend Module: modules/social/friends (useFriendsStore)
# - UI: FriendsList, FriendRequestsPanel, PresenceIndicator, BlockList, RecentPlayers, InviteFriendModal
# - Forms: FriendSearchForm, SendRequestForm, InviteToPartyForm
# - Hooks: useFriends, usePresence, useFriendRequests, useFriendInvites
```

---

## ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)

1. –û–ø–∏—Å–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥—Ä—É–∑–µ–π, –∑–∞–ø—Ä–æ—Å–æ–≤, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è, –±–ª–æ–∫–æ–≤, recent players.
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏, –ø—Ä–∏–Ω—è—Ç–∏—è, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, —É–¥–∞–ª–µ–Ω–∏—è –¥—Ä—É–∑–µ–π.
3. –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ–º, —Å—Ç–∞—Ç—É—Å–∞–º–∏, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏.
4. –û–ø–∏—Å–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, mute, privacy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
5. –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å recent players, social suggestions, party invite hooks.
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å real-time —Å–æ–±—ã—Ç–∏—è, rate limits, throttling, audit.
7. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã, —Ç–µ—Å—Ç-–∫–µ–π—Å—ã, —á–µ–∫–ª–∏—Å—Ç.

---

## üîÄ Endpoints

1. **GET `/api/v1/social/friends`** ‚Äì —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π —Å presence, —Å—Ç–∞—Ç—É—Å–∞–º–∏, –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π.
2. **POST `/api/v1/social/friends`** ‚Äì –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è (–ø–æ playerId, nickname, externalId).
3. **GET `/api/v1/social/friends/requests`** ‚Äì –≤—Ö–æ–¥—è—â–∏–µ –∏ –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏.
4. **POST `/api/v1/social/friends/requests/{requestId}/accept`** ‚Äì –ø—Ä–∏–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å.
5. **POST `/api/v1/social/friends/requests/{requestId}/decline`** ‚Äì –æ—Ç–∫–ª–æ–Ω–∏—Ç—å/–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å.
6. **DELETE `/api/v1/social/friends/{friendId}`** ‚Äì —É–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π.
7. **GET `/api/v1/social/friends/presence`** ‚Äì presence-feed (real-time fallback / polling).
8. **POST `/api/v1/social/friends/presence`** ‚Äì –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π presence (activity, availability).
9. **GET `/api/v1/social/friends/recent`** ‚Äì —Å–ø–∏—Å–æ–∫ –Ω–µ–¥–∞–≤–Ω–∏—Ö –∏–≥—Ä–æ–∫–æ–≤.
10. **GET `/api/v1/social/friends/suggestions`** ‚Äì –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥—Ä—É–∑–µ–π (–æ–±—â–∏–µ –¥—Ä—É–∑—å—è, –∫–ª–∞–Ω—ã, –º–∞—Ç—á–º–µ–π–∫–∏–Ω–≥).
11. **GET `/api/v1/social/friends/blocks`** ‚Äì —Å–ø–∏—Å–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫/–∏–≥–Ω–æ—Ä.
12. **POST `/api/v1/social/friends/blocks`** ‚Äì –¥–æ–±–∞–≤–∏—Ç—å –≤ –±–ª–æ–∫/–∏–≥–Ω–æ—Ä (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ç–∏–ø, –ø—Ä–∏—á–∏–Ω–∞, —Å—Ä–æ–∫).
13. **DELETE `/api/v1/social/friends/blocks/{blockId}`** ‚Äì —Å–Ω—è—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É.
14. **POST `/api/v1/social/friends/invites`** ‚Äì –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é/–∫–ª–∞–Ω/party.
15. **WS `/api/v1/social/friends/stream`** ‚Äì —Å–æ–±—ã—Ç–∏—è: `friend-request`, `request-accepted`, `friend-removed`, `presence-update`, `block-added`, `invite-received`.

---

## üß± –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

- **Friend** ‚Äì `playerId`, `nickname`, `platform`, `relationship`, `presence`, `favorite`, `metadata`.
- **FriendRequest** ‚Äì `requestId`, `from`, `to`, `message`, `createdAt`, `status`, `expiresAt`.
- **Presence** ‚Äì `state` (`ONLINE|AWAY|IN_MATCH|OFFLINE`), `activity`, `sessionId`, `platform`, `lastSeen`.
- **BlockEntry** ‚Äì `blockId`, `targetId`, `type` (`BLOCK|MUTE|REPORT`), `reason`, `expiresAt`.
- **RecentPlayer** ‚Äì `playerId`, `metAt`, `context` (`MATCH|TRADE|CLAN`), `score`.
- **Suggestion** ‚Äì `playerId`, `source`, `mutualFriends`, `relevance`.
- **Invite** ‚Äì `inviteId`, `from`, `to`, `context`, `payload`, `expiresAt`.
- **RealtimeEventPayload** ‚Äì `friendRequest`, `requestAccepted`, `friendRemoved`, `presenceUpdate`, `blockAdded`, `inviteReceived`.
- **Error Schema (`FriendError`)** ‚Äì codes (`REQUEST_LIMIT`, `ALREADY_FRIENDS`, `BLOCKED`, `PRIVACY_RESTRICTED`, `RATE_LIMITED`, `INVITE_FAILED`).

---

## üß≠ –ü—Ä–∏–Ω—Ü–∏–ø—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: `BearerAuth`; –æ—Ç–¥–µ–ª—å–Ω—ã–π `ServiceToken` –¥–ª—è internal events.
- Rate Limiting: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫ –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å shared throttle responses.
- Idempotency: –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥—Ä—É–∂–±—ã —Å `idempotencyKey`.
- Privacy: —É–≤–∞–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (visibility, search opt-out), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
- Audit: –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ moderation-service.
- Localization: –≤—Å–µ message templates —á–µ—Ä–µ–∑ shared localization.

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã

- –ü–æ–∏—Å–∫ –¥—Ä—É–≥–∞ –ø–æ nickname –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞.
- –ü—Ä–∏—ë–º –∑–∞–ø—Ä–æ—Å–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π, –ø—É—à —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ presence –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ realtime —Å–æ–±—ã—Ç–∏–π.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ –≤ –±–ª–æ–∫ –ø–æ—Å–ª–µ –∂–∞–ª–æ–±—ã.
- –ü–æ–ª—É—á–µ–Ω–∏–µ recent players –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–∞—Ç—á–∞ –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ party.

---

## üîó –°–≤—è–∑–Ω–æ—Å—Ç–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å session-service (presence) –∏ notification-service (push, email).
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UI Leaderboards/Friends (Task 211) –∏ Clan/Guild —Å–∏—Å—Ç–µ–º—ã.
- –î–∞–Ω–Ω—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ matchmaking, achievements (social milestones), analytics.

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

1. `friend-system.yaml` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏, presence, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, invites.
2. –ü—Ä–æ–ø–∏—Å–∞–Ω—ã –º–æ–¥–µ–ª–∏, —Å–æ–±—ã—Ç–∏—è, –æ—à–∏–±–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
3. –ü—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã, —á–µ–∫–ª–∏—Å—Ç –∑–∞–∫—Ä—ã—Ç.

---

## üìé Checklist

- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —à–∞–±–ª–æ–Ω `api-generation-task-template.md`
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, UI –º–æ–¥—É–ª—å, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ —Å–æ–±—ã—Ç–∏—è –ø–æ–∫—Ä—ã–≤–∞—é—Ç –¥—Ä—É–∂–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏, –æ—à–∏–±–∫–∏, –ø—Ä–∏–º–µ—Ä—ã, –∫—Ä–∏—Ç–µ—Ä–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `tasks/config/brain-mapping.yaml`

---

## ‚ùìFAQ

**Q:** –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ offline —Å–æ–æ–±—â–µ–Ω–∏–π?**
**A:** –ù–µ—Ç –≤ –ø–µ—Ä–≤–æ–π –≤–µ—Ä—Å–∏–∏, –Ω–æ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ notification inbox.

**Q:** –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å cross-platform –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã?**
**A:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unified `PlayerIdentifier` (platform + externalId) –∏ `lookup` endpoint –≤ shared components; —É–ø–æ–º—è–Ω—É—Ç—å –≤ –æ–ø–∏—Å–∞–Ω–∏–∏.


