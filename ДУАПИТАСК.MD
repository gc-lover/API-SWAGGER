# ДУАПИТАСК.MD

**Файл для передачи AI агенту (API Task Creator) для создания заданий из документов .BRAIN**

---

## Что это?

Этот файл содержит ссылки на правила и инструкции для AI агента, который создает задания для API-SWAGGER на основе документов из .BRAIN.

**Минимальный вход для работы агента:**
1. Этот файл (ДУАПИТАСК.MD)
2. ПРАВИЛО: `API-SWAGGER/.cursor/rules/api-task-creator-rules.mdc` (уже включено автоматически)
3. ИНСТРУКЦИЯ: `API-SWAGGER/tasks/config/task-creation-guide.md`
4. ДОКУМЕНТ из .BRAIN: путь к файлу или директории с фичами для проработки

**Дополнительная информация (опционально):**
- `.BRAIN/06-tasks/active/CURRENT-WORK.md` - индекс текущей работы
- `.BRAIN/06-tasks/active/CURRENT-WORK/current-status.md` - краткий статус завершенных фич
- `.BRAIN/06-tasks/active/CURRENT-WORK/open-questions.md` - открытые вопросы для проработки
- `.BRAIN/06-tasks/active/CURRENT-WORK/active/` - активные обсуждения (в процессе)
- `.BRAIN/06-tasks/active/CURRENT-WORK/archive/` - завершенные обсуждения (для справки)

---

## Ссылки на правила и документацию

### Правила работы

**Файл:** `API-SWAGGER/.cursor/rules/api-task-creator-rules.mdc`

**Содержит:**
- Роль агента: читать .BRAIN и создавать задачи для агентов в API-SWAGGER
- Минимальный вход для работы
- Процесс работы пошагово
- Обязательные элементы задания
- Принципы проекта

**Читать:** [Правила работы](./.cursor/rules/api-task-creator-rules.mdc)

---

### Инструкция по созданию заданий

**Файл:** `API-SWAGGER/tasks/config/task-creation-guide.md`

**Содержит:**
- Детальный процесс работы по шагам
- Как извлечь информацию из документа .BRAIN
- Как определить целевую структуру API
- Как создать полное задание по шаблону
- Чеклист проверки задания
- Как обновить маппинг и документ .BRAIN

**Читать:** [Инструкция по созданию заданий](./tasks/config/task-creation-guide.md)

---

### Шаблон задания

**Файл:** `API-SWAGGER/tasks/templates/api-generation-task-template.md`

**Содержит:**
- Полный шаблон задания для агента-исполнителя
- Все обязательные секции с примерами
- Структура задания максимально детализирована

**Читать:** [Шаблон задания](./tasks/templates/api-generation-task-template.md)

---

### Чеклист проверки

**Файл:** `API-SWAGGER/tasks/config/checklist.md`

**Содержит:**
- Детальный чеклист проверки задания перед созданием
- Все блоки для проверки (15 блоков)
- Итоговая проверка

**Читать:** [Чеклист проверки](./tasks/config/checklist.md)

---

## Как использовать

### Вариант 1: Один файл из .BRAIN

**Команда:**
```
Делай таски для .BRAIN/02-gameplay/combat/shooter-mechanics.md
```

**Что делает агент:**
1. Читает этот файл (ДУАПИТАСК.MD)
2. Читает правила из `api-task-creator-rules.mdc`
3. Читает инструкцию из `task-creation-guide.md`
4. Читает документ из .BRAIN (указанный путь)
5. Создает полное задание по шаблону
6. Проверяет по чеклисту
7. Сохраняет в `tasks/active/queue/`
8. Обновляет `brain-mapping.yaml`
9. Обновляет документ .BRAIN (добавляет секцию отслеживания)

---

### Вариант 2: Директория из .BRAIN

**Команда:**
```
Делай таски для .BRAIN/02-gameplay/combat/
```

**Что делает агент:**
1. Читает этот файл (ДУАПИТАСК.MD)
2. Читает правила из `api-task-creator-rules.mdc`
3. Читает инструкцию из `task-creation-guide.md`
4. Читает ВСЕ файлы .md из указанной директории .BRAIN
5. Для каждого файла создает полное задание по шаблону
6. Проверяет каждое задание по чеклисту
7. Сохраняет все задания в `tasks/active/queue/`
8. Обновляет `brain-mapping.yaml` (добавляет все записи)
9. Обновляет каждый документ .BRAIN (добавляет секцию отслеживания)

---

### Вариант 3: С дополнительным файлом

**Команда:**
```
Делай таски для .BRAIN/02-gameplay/combat/shooter-mechanics.md
И приложил .BRAIN/02-gameplay/combat/abilities/active-abilities.md
```

**Что делает агент:**
1. Читает этот файл (ДУАПИТАСК.MD)
2. Читает правила из `api-task-creator-rules.mdc`
3. Читает инструкцию из `task-creation-guide.md`
4. Читает все указанные документы из .BRAIN
5. Создает задания для каждого документа
6. Проверяет каждое задание по чеклисту
7. Сохраняет все задания в `tasks/active/queue/`
8. Обновляет `brain-mapping.yaml`
9. Обновляет все документы .BRAIN

---

## Процесс работы агента

### Шаг 1: Чтение правил и инструкций

Агент должен:
1. Прочитать `API-SWAGGER/.cursor/rules/api-task-creator-rules.mdc` - понять свою роль
2. Прочитать `API-SWAGGER/tasks/config/task-creation-guide.md` - понять процесс работы
3. Прочитать `API-SWAGGER/tasks/templates/api-generation-task-template.md` - понять структуру задания
4. Прочитать `API-SWAGGER/tasks/config/checklist.md` - понять критерии проверки

### Шаг 2: Анализ входных данных

Агент должен:
1. Прочитать документ(ы) из .BRAIN полностью
2. Извлечь всю информацию: концепции, механики, правила, зависимости
3. Определить целевую структуру API для каждого документа
4. (Опционально) Проверить текущий статус фичи в `.BRAIN/06-tasks/active/CURRENT-WORK/current-status.md` или архив обсуждения в `archive/`
5. (Опционально) Учесть открытые вопросы из `.BRAIN/06-tasks/active/CURRENT-WORK/open-questions.md`, если они связаны с документом

### Шаг 3: Создание заданий

Агент должен:
1. Создать полное задание по шаблону для каждого документа
2. Заполнить все секции: метаданные, источники, план, endpoints, модели, критерии, FAQ
3. Проверить задание по чеклисту
4. Сохранить в `tasks/active/queue/task-XXX-description.md`

### Шаг 4: Обновление маппинга

Агент должен:
1. Открыть `API-SWAGGER/tasks/config/brain-mapping.yaml`
2. Добавить запись для каждого созданного задания:
   ```yaml
   mappings:
     - source: ".BRAIN/path/to/file.md"
       target: "api/v1/path/to/file.yaml"
       task_id: "API-TASK-XXX"
       task_file: "tasks/active/queue/task-XXX-description.md"
       status: "queued"
       created: "YYYY-MM-DD HH:MM"
       version: "v1.0.0"
   ```

### Шаг 5: Обновление документов .BRAIN

Агент должен:
1. Открыть каждый документ .BRAIN, для которого создано задание
2. Добавить секцию отслеживания заданий (в начало или конец документа):
   ```markdown
   ---
   **API Tasks Status:**
   - Status: created
   - Tasks:
     - API-TASK-XXX: api/v1/path/to/file.yaml (YYYY-MM-DD)
   - Last Updated: YYYY-MM-DD HH:MM
   ---
   ```

### Шаг 6: Финализация

Агент должен:
1. Проверить, что все задания созданы и сохранены
2. Проверить, что маппинг обновлен
3. Проверить, что все документы .BRAIN обновлены
4. Убедиться, что задания самодостаточны для агентов-исполнителей
5. **ОБЯЗАТЕЛЬНО сделать коммит** для сохранения истории работы

### Шаг 7: Коммит изменений

**ОБЯЗАТЕЛЬНО:** После завершения работы над заданием нужно сделать коммит для сохранения истории и лучшего контроля действий агентов.

Агент должен:
1. Использовать скрипт автокоммита: `scripts/autocommit.ps1` (Windows) или `scripts/autocommit.sh` (Linux/Mac)
2. Выполнить команду из корня репозитория:
   ```bash
   # Windows
   .\scripts\autocommit.ps1 "Созданы задания для .BRAIN документов: список заданий"
   
   # Linux/Mac
   ./scripts/autocommit.sh "Созданы задания для .BRAIN документов: список заданий"
   ```
3. Если сообщение не указано, скрипт сгенерирует его автоматически на основе измененных файлов
4. Коммит должен включать:
   - Созданные задания (в `tasks/active/queue/`)
   - Обновленный `brain-mapping.yaml`
   - Обновленные документы .BRAIN (если были изменены)

**Зачем это нужно:**
- Сохранение истории работы агентов
- Возможность отслеживания изменений
- Лучший контроль действий агентов
- Возможность отката изменений при необходимости

---

## Обязательные элементы задания

Каждое задание должно содержать:

1. **Метаданные:**
   - Task ID (API-TASK-XXX)
   - Тип (API Generation)
   - Приоритет (низкий | средний | высокий | критический)
   - Статус (queued)
   - Зависимости (если есть)

2. **Источники:**
   - Путь к документу .BRAIN
   - Версия документа
   - Статус документа
   - Связанные документы

3. **Целевая структура:**
   - Полный путь к файлу API
   - Версия API
   - Структура директории

4. **Детальный план:**
   - Минимум 5 шагов
   - Каждый шаг с описанием действий
   - Ожидаемый результат для каждого шага

5. **Endpoints:**
   - Для каждого: метод, путь, назначение, параметры, ответы, примеры

6. **Модели данных:**
   - Для каждой: все поля, типы, валидация, примеры

7. **Принципы и правила:**
   - SOLID, DRY, KISS
   - OpenAPI 3.0.3
   - Workspace rules

8. **Критерии приемки:**
   - Чеклист из 10+ пунктов
   - Каждый пункт проверяемый и измеримый

9. **FAQ:**
   - Ответы на типичные вопросы
   - Разрешение возможных проблем

---

## Принципы работы

1. **Самодостаточность:** Задание должно содержать всю информацию для агента-исполнителя без обращения к .BRAIN документам

2. **Детализация:** Максимально подробное описание всех шагов, endpoints, моделей

3. **Проверяемость:** Все критерии приемки должны быть измеримыми

4. **Связность:** Все связи между документами и API должны быть отражены

5. **Отслеживание:** Все созданные задания должны быть зафиксированы в маппинге и документах .BRAIN

---

## Примеры команд

### Пример 1: Один файл
```
Делай таски для .BRAIN/02-gameplay/combat/shooter-mechanics.md
```

### Пример 2: Директория
```
Делай таски для .BRAIN/02-gameplay/combat/
```

### Пример 3: Несколько файлов
```
Делай таски для:
- .BRAIN/02-gameplay/combat/shooter-mechanics.md
- .BRAIN/02-gameplay/combat/abilities/active-abilities.md
- .BRAIN/02-gameplay/progression/skill-system.md
```

### Пример 4: С контекстом
```
Делай таски для .BRAIN/02-gameplay/combat/
Приоритет: высокий
```

---

## Архитектура и иерархия директорий

**ВАЖНО:** Агент ОБЯЗАН следовать установленной архитектуре и иерархии директорий для лучшего контроля действий и получения лучшего результата.

**Полное описание архитектуры:** `API-SWAGGER/ARCHITECTURE.md`

### Основные принципы архитектуры:

1. **Версионирование API:** Каждая версия API в отдельной директории (`v1/`, `v2/`, и т.д.)
2. **Иерархическая структура:** От общего к частному, соответствие структуре `.BRAIN`
3. **Именование:** Файлы - `kebab-case.yaml`, директории - `kebab-case`, модели - `PascalCase`
4. **Ограничение размера:** МАКСИМУМ 400 строк на файл, если больше - разбить на несколько
5. **Обработка ошибок - МИНИМАЛИСТИЧНО:**
   - **НЕ создавай** множество разных типов ошибок для каждого HTTP статуса
   - Используй **ЕДИНУЮ модель Error** из `shared/common/responses.yaml`
   - Backend определяет HTTP статус по коду ошибки (`ErrorCode` enum)
   - Коды: `AUTH_*` (401/403), `BIZ_*` (404/409), `VAL_*` (400), `INT_*` (500/503)
5.1 **Именование моделей - ИЗБЕГАЙ КОНФЛИКТОВ:**
   - **НЕ используй** имена встроенных классов Java и JavaScript
   - Проблемные имена: `Character`, `String`, `Number`, `Boolean`, `Date`, `Error`, `Event`, `File`, `Map`, `Set`, `List`
   - Используй префиксы: `GameCharacter`, `GameEvent`, `GameItem`, `PlayerProfile`
6. **Разбиение файлов:** 
   - **ВАЖНО:** OpenAPI Generator НЕ поддерживает `$ref` для paths (endpoints) из внешних файлов
   - Paths (endpoints) ВСЕГДА должны быть в главном файле
   - Components (schemas, responses) МОЖНО выносить в отдельные файлы через `$ref`
7. **Связи с .BRAIN:** Каждый API должен иметь ссылки на оригинальные документы .BRAIN
8. **Документация:** Каждая директория должна иметь `README.md` с обзором

### Структура директорий API:

```
api/v1/
├── gameplay/                  # Игровая механика
│   ├── combat/                # Боевая система
│   ├── progression/           # Прокачка и развитие
│   ├── economy/               # Экономика
│   ├── social/                # Социальные механики
│   └── world/                 # Игровой мир
├── lore/                      # Лор и сеттинг
│   ├── factions.yaml
│   ├── locations.yaml
│   ├── characters.yaml
│   └── universe.yaml
├── narrative/                 # Повествование
│   ├── quests.yaml
│   ├── dialogues.yaml
│   └── romances.yaml
└── shared/                    # Общие компоненты
    ├── common/                # Общие модели и схемы
    └── security/               # Безопасность
```

**Соответствие .BRAIN:**
- `.BRAIN/02-gameplay/` → `api/v1/gameplay/`
- `.BRAIN/03-lore/` → `api/v1/lore/`
- `.BRAIN/04-narrative/` → `api/v1/narrative/`

### Структура файлов

```
API-SWAGGER/
├── ARCHITECTURE.md                # Описание архитектуры (ВАЖНО!)
├── ДУАПИТАСК.MD                    # Этот файл
├── АПИТАСК.MD                      # Инструкции для исполнителя
├── .cursor/
│   └── rules/
│       └── api-task-creator-rules.mdc  # Правила работы
├── api/
│   └── v1/                         # Версия API
│       ├── gameplay/               # Игровая механика
│       ├── lore/                   # Лор и сеттинг
│       └── narrative/               # Повествование
├── tasks/
│   ├── README.md                    # Описание системы заданий
│   ├── templates/
│   │   └── api-generation-task-template.md  # Шаблон задания
│   ├── config/
│   │   ├── task-creation-guide.md   # Инструкция (ЭТОТ ФАЙЛ ВАЖЕН!)
│   │   ├── checklist.md             # Чеклист проверки
│   │   └── brain-mapping.yaml        # Маппинг .BRAIN -> задания
│   ├── active/
│   │   ├── queue/                    # Очередь заданий (сюда сохраняются)
│   │   └── in-progress/              # Задания в работе
│   └── completed/                    # Завершенные задания
└── scripts/
    ├── autocommit.ps1                # Скрипт автокоммита (Windows)
    └── autocommit.sh                 # Скрипт автокоммита (Linux/Mac)
```

---

## Важные файлы для агента

**Обязательно прочитать:**
1. `API-SWAGGER/.cursor/rules/api-task-creator-rules.mdc` - правила работы
2. `API-SWAGGER/tasks/config/task-creation-guide.md` - инструкция по созданию
3. `API-SWAGGER/tasks/templates/api-generation-task-template.md` - шаблон задания
4. `API-SWAGGER/tasks/config/checklist.md` - чеклист проверки

**Использовать:**
- `API-SWAGGER/tasks/config/brain-mapping.yaml` - обновлять при создании заданий

**Дополнительная информация (для контекста):**
- `.BRAIN/06-tasks/active/CURRENT-WORK.md` - индекс текущей работы
- `.BRAIN/06-tasks/active/CURRENT-WORK/current-status.md` - краткий статус завершенных фич
- `.BRAIN/06-tasks/active/CURRENT-WORK/open-questions.md` - открытые вопросы для проработки
- `.BRAIN/06-tasks/active/CURRENT-WORK/archive/` - завершенные обсуждения (для контекста истории)

**Результат:**
- `API-SWAGGER/tasks/active/queue/task-XXX-description.md` - созданные задания

---

## Контрольный список для агента

Перед началом работы:
- [ ] Прочитал `api-task-creator-rules.mdc`
- [ ] Прочитал `task-creation-guide.md`
- [ ] Прочитал шаблон задания
- [ ] Прочитал чеклист
- [ ] Прочитал документ(ы) из .BRAIN

После создания задания:
- [ ] Задание создано по шаблону
- [ ] Все секции заполнены
- [ ] Проверено по чеклисту
- [ ] Сохранено в `tasks/active/queue/`
- [ ] Обновлен `brain-mapping.yaml`
- [ ] Обновлен документ .BRAIN (добавлена секция отслеживания)
- [ ] Целевой путь API соответствует архитектуре директорий
- [ ] Проверено соответствие структуре `.BRAIN` → `API-SWAGGER`
- [ ] **Сделан коммит** изменений (для сохранения истории)

---

## Архитектура и иерархия директорий

**ВАЖНО:** Агент ОБЯЗАН следовать установленной архитектуре и иерархии директорий. Полное описание в `API-SWAGGER/ARCHITECTURE.md`.

**Основные принципы:**
- Структура API соответствует структуре `.BRAIN`
- Каждая директория имеет `README.md` с обзором
- Файлы API не должны превышать 400 строк
- Именование: файлы - `kebab-case.yaml`, модели - `PascalCase`
- Каждый API должен иметь ссылки на оригинальные документы .BRAIN

## Коммиты и сохранение истории

**ОБЯЗАТЕЛЬНО:** После завершения работы над заданием нужно сделать коммит для сохранения истории и лучшего контроля действий агентов.

**Использование скрипта автокоммита:**
```bash
# Windows
.\scripts\autocommit.ps1 "Сообщение коммита"

# Linux/Mac
./scripts/autocommit.sh "Сообщение коммита"
```

**Если сообщение не указано**, скрипт сгенерирует его автоматически на основе измененных файлов.

**Зачем это нужно:**
- Сохранение истории работы агентов
- Возможность отслеживания изменений
- Лучший контроль действий агентов
- Возможность отката изменений при необходимости

## Примечания

- **Название файла:** ДУАПИТАСК.MD (именно так, латиницей, как указано)
- **Местоположение:** `API-SWAGGER/ДУАПИТАСК.MD`
- **Назначение:** Передача агенту инструкций для создания заданий
- **Использование:** Просто приложить этот файл и указать путь к документу(ам) из .BRAIN
- **Архитектура:** Обязательно следовать структуре из `ARCHITECTURE.md`

---

**Готов к работе! Пришли мне этот файл и путь к документу из .BRAIN - я создам задания.**
