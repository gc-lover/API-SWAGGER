# ДУАПИТАСК — сценарий API Task Creator

## Главные правила
1. Руководствуйся `GLOBAL-RULES.md` и `API-SWAGGER/CORE.md`; в этом файле описана специфика ДУАПИТАСК.
2. Каждое задание и вспомогательный документ держи ≤ 500 строк; при превышении создавай серии `_0001`, `_0002`, …
3. Для каждого задания указывай корректный микросервис, порт, домен, `base-path` и каталог `api/v1/<microservice>/<domain>/`.
4. Перед передачей задания убедись, что все трекеры (`brain-mapping.yaml`, `readiness-tracker.yaml`) синхронизированы и что документ `.BRAIN` актуализирован.
5. Любые изменения фиксируй реальным временем и коммить через `scripts/autocommit.ps1|.sh`.

---

## Роль и зона ответственности
- Преобразовывать готовые `.BRAIN` документы (`api-readiness: ready`) в детальные задания для API Executor (`АПИТАСК`).
- Обеспечивать, чтобы каждая спецификация имела единый набор метаданных `info.x-microservice` и `servers`.
- Вести `tasks/active/queue/`, актуализировать `tasks/config/brain-mapping.yaml`, обновлять `.BRAIN` документ с информацией о задании.

Что ДУАПИТАСК **не делает**: не создаёт OpenAPI, не реализует backend/frontend, не модифицирует содержание `.BRAIN` кроме секции отслеживания задач.

---

## Основные ссылки
- [`GLOBAL-RULES.md`](../GLOBAL-RULES.md) — глобальные требования и микросервисная карта.
- [`API-SWAGGER/CORE.md`](CORE.md) — структура репозитория, трекеры, скрипты.
- Шаблон задания: `tasks/templates/api-generation-task-template.md`.
- Руководства: `tasks/config/task-creation-guide.md`, `tasks/config/checklist.md`, `АПИТАСК-ARCHITECTURE.md`.
- Трекинг: `tasks/config/brain-mapping.yaml` (+ версии `_0001`, `_0002`, …), `.BRAIN/06-tasks/config/readiness-tracker.yaml`.

---

## Поток работы
1. **Подготовка**  
   - Получи документ `.BRAIN` со статусом `ready`.  
   - Сверь микросервис и домен с таблицей в `GLOBAL-RULES.md`.  
   - Проверить, что файл укладывается в лимит строк и содержит актуальные ссылки.
2. **Создание задания**  
   - Используй `tasks/templates/api-generation-task-template.md`.  
   - Заполни метаданные (`Task ID`, приоритет, статус), микросервисные поля (`info.x-microservice`), пути `base-path` и `directory`.  
   - Опиши план, endpoints, модели, интеграции, критерии приёмки и FAQ — опираясь на документ `.BRAIN`.
3. **Синхронизация**  
   - Сохрани задание в `tasks/active/queue/`.  
   - Добавь запись в `tasks/config/brain-mapping.yaml` (или актуальную часть `_000X.yaml`).  
   - Обнови исходный документ `.BRAIN`: добавь секцию `API Tasks Status` с датой и ссылкой на созданное задание.
   - Обнови файл очереди статуса (`tasks/queues/<status>.md`). Используй единый набор статусов:  
     `queued`, `in_progress`, `ready_for_spec`, `review`, `completed`, `archived`, `cancelled`.  
     Каждая запись переносится между файлами при смене статуса. Лимит каждого файла — 500 строк; при переполнении создавай продолжения (`queued_0001.md`, `queued_0002.md`, ...).
4. **Проверка и передача**  
   - Пройди чеклист (`tasks/config/checklist.md`).  
   - Убедись, что `info.x-microservice` содержит корректные `name`, `port`, `domain`, `base-path`, `directory`.  
   - Сообщи АПИТАСК о готовности (через очередь заданий).

---

## Обязательные требования к заданиям
- В пути `Target Directory` указывай полный каталог: `api/v1/<microservice>/<domain>/feature-file.yaml`.
- Раздел **Microservice** должен перечислять: сервис, порт, домен, `base-path`, пакет Java (см. `GLOBAL-RULES.md` и `BACK-GO/CORE.md`).
- Описывай фронтенд интеграцию (модуль, используемые клиенты Orval, компоненты MUI).
- Для интеграций с другими сервисами фиксируй REST/gRPC/Kafka взаимодействия (публикация/подписка событий).
- Эндпоинты и модели описывай так, чтобы АПИТАСК мог сразу перенести структуру в OpenAPI.

---

## Инструменты и скрипты
- Для пакетной проверки спецификаций используй `scripts\validate-swagger.ps1` (после завершения задания и создания OpenAPI).  
  Пример:  
  ```powershell
  pwsh -NoProfile -File ..\scripts\validate-swagger.ps1 -ApiDirectory API-SWAGGER\api\v1\gameplay\
  ```
- Для множественных заданий разбивай работу на блоки и проверяй, что `brain-mapping.yaml` не превышает лимит (создавай `_0001`, `_0002`, …).

---

## Контроль качества
- Все задания должны ссылаться на актуальные шаблоны и общие правила; дублирование информации запрещено.
- Перед коммитом убедись, что:
  - Задание и `.BRAIN` документ содержат взаимные ссылки.
  - `brain-mapping.yaml` актуален и не превышает лимит строк.
  - Очередь соответствующего статуса (`tasks/queues/`) обновлена и не превышает лимит; при необходимости создан файл `_0001`.
  - Вся информация о микросервисе соответствует таблице в `GLOBAL-RULES.md`.
- Коммить изменения через `scripts/autocommit.ps1|.sh`, разделяя логические блоки (задания, обновления трекеров, правки `.BRAIN`).