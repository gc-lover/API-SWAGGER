# Personal NPC Tool API - Управление сценариями
# Источник: .BRAIN/02-gameplay/social/personal-npc-tool.md (v1.0.0)
# Раздел: Endpoints для управления сценариями (блупринты и инстансы)

openapi: 3.0.3
info:
  title: Personal NPC Tool - Scenarios
  version: 1.0.0
  description: |
    Endpoints для управления сценариями (блупринты и инстансы).
    Источник: .BRAIN/02-gameplay/social/personal-npc-tool.md (v1.0.0)

paths:
  # Блупринты сценариев
  /gameplay/social/npc/scenarios/blueprints:
    post:
      summary: Создать новый блупринт сценария
      operationId: createBlueprint
      tags: [Scenarios, Blueprints]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../personal-npc-tool-requests.yaml#/components/schemas/CreateBlueprintRequest'
      responses:
        '201':
          description: Блупринт создан
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioBlueprint'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '409': {$ref: '../../shared/common/responses.yaml#/components/responses/Conflict'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

    get:
      summary: Получить список блупринтов
      operationId: listBlueprints
      tags: [Scenarios, Blueprints]
      security:
        - BearerAuth: []
      parameters:
        - name: author_id
          in: query
          schema: {type: string, format: uuid}
        - name: category
          in: query
          schema: {type: string, enum: [economy, social, combat, logistics]}
        - name: is_public
          in: query
          schema: {type: boolean}
        - name: is_verified
          in: query
          schema: {type: boolean}
      responses:
        '200':
          description: Список блупринтов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioBlueprint'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/blueprints/{blueprint_id}:
    get:
      summary: Получить информацию о блупринте
      operationId: getBlueprint
      tags: [Scenarios, Blueprints]
      security:
        - BearerAuth: []
      parameters:
        - name: blueprint_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '200':
          description: Информация о блупринте
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioBlueprint'
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

    put:
      summary: Обновить блупринт сценария
      operationId: updateBlueprint
      tags: [Scenarios, Blueprints]
      security:
        - BearerAuth: []
      parameters:
        - name: blueprint_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../personal-npc-tool-requests.yaml#/components/schemas/UpdateBlueprintRequest'
      responses:
        '200':
          description: Блупринт обновлен
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioBlueprint'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

    delete:
      summary: Удалить блупринт сценария
      operationId: deleteBlueprint
      tags: [Scenarios, Blueprints]
      security:
        - BearerAuth: []
      parameters:
        - name: blueprint_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '204': {description: Блупринт удален}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '422': {$ref: '../../shared/common/responses.yaml#/components/responses/UnprocessableEntity'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  # Инстансы сценариев
  /gameplay/social/npc/scenarios/instances:
    post:
      summary: Создать и запустить инстанс сценария
      operationId: createInstance
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../personal-npc-tool-requests.yaml#/components/schemas/CreateInstanceRequest'
      responses:
        '201':
          description: Инстанс создан
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '409': {$ref: '../../shared/common/responses.yaml#/components/responses/Conflict'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

    get:
      summary: Получить список инстансов
      operationId: listInstances
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: owner_id
          in: query
          schema: {type: string, format: uuid}
        - name: npc_id
          in: query
          schema: {type: string, format: uuid}
        - name: blueprint_id
          in: query
          schema: {type: string, format: uuid}
        - name: status
          in: query
          schema: {type: string, enum: [pending, running, paused, completed, failed, cancelled]}
      responses:
        '200':
          description: Список инстансов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/instances/{instance_id}:
    get:
      summary: Получить информацию об инстансе сценария
      operationId: getInstance
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '200':
          description: Информация об инстансе
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/instances/{instance_id}/start:
    post:
      summary: Запустить инстанс сценария
      operationId: startInstance
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '200':
          description: Инстанс запущен
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '422': {$ref: '../../shared/common/responses.yaml#/components/responses/UnprocessableEntity'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/instances/{instance_id}/pause:
    post:
      summary: Приостановить инстанс сценария
      operationId: pauseInstance
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '200':
          description: Инстанс приостановлен
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '422': {$ref: '../../shared/common/responses.yaml#/components/responses/UnprocessableEntity'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/instances/{instance_id}/resume:
    post:
      summary: Возобновить инстанс сценария
      operationId: resumeInstance
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '200':
          description: Инстанс возобновлен
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '422': {$ref: '../../shared/common/responses.yaml#/components/responses/UnprocessableEntity'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/instances/{instance_id}/cancel:
    post:
      summary: Отменить инстанс сценария
      operationId: cancelInstance
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      requestBody:
        content:
          application/json:
            schema:
              $ref: '../personal-npc-tool-requests.yaml#/components/schemas/CancelInstanceRequest'
      responses:
        '200':
          description: Инстанс отменен
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioInstance'
        '400': {$ref: '../../shared/common/responses.yaml#/components/responses/BadRequest'}
        '403': {$ref: '../../shared/common/responses.yaml#/components/responses/Forbidden'}
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '422': {$ref: '../../shared/common/responses.yaml#/components/responses/UnprocessableEntity'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

  /gameplay/social/npc/scenarios/instances/{instance_id}/kpi:
    get:
      summary: Получить KPI инстанса сценария
      operationId: getInstanceKPI
      tags: [Scenarios, Instances]
      security:
        - BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema: {type: string, format: uuid}
      responses:
        '200':
          description: KPI инстанса
          content:
            application/json:
              schema:
                $ref: '../personal-npc-tool-models-2.yaml#/components/schemas/ScenarioKPI'
        '404': {$ref: '../../shared/common/responses.yaml#/components/responses/NotFound'}
        '500': {$ref: '../../shared/common/responses.yaml#/components/responses/InternalServerError'}

