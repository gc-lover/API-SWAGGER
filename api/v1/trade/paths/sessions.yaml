tradeSessionsRoot:
  post:
    tags:
      - TradeSessions
    summary: Создать торговую сессию
    description: |
      Инициирует P2P торговлю между двумя персонажами. Выполняет проверку
      близости, активных ограничений и загружает стартовые ограничения для
      предметов и валюты.
    operationId: createTradeSession
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/CreateTradeSessionRequest'
          examples:
            default:
              value:
                initiator_character_id: "7f6c2f0c-0d44-44e4-a9e4-5c8fef3e5724"
                target_character_id: "0a8f9868-5bf9-4c5d-8871-4dd47b84d8df"
                shard: "eu-central-1"
                zone_id: "neon_market"
                context: "WORLD"
                expires_in_seconds: 300
                invitation_id: "2d59fb7d-9668-4f5f-9b97-bf2b184f5346"
    responses:
      '201':
        description: Торговая сессия создана
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '429':
        $ref: '../shared/common/responses.yaml#/components/responses/TooManyRequests'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionById:
  get:
    tags:
      - TradeSessions
    summary: Получить состояние торговой сессии
    description: Возвращает текущее состояние, предложения сторон, таймеры и активные предупреждения.
    operationId: getTradeSession
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    responses:
      '200':
        description: Состояние торговой сессии
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '410':
        $ref: '../shared/common/responses.yaml#/components/responses/ResourceGone'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionItems:
  post:
    tags:
      - TradeSessions
    summary: Добавить или обновить предмет в предложении
    description: |
      Синхронизирует состояние предмета в предложении стороны сделки. Поддерживает
      добавление, обновление количества и комментариев. После блокировки
      предложения изменение недоступно.
    operationId: addTradeSessionItem
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/AddTradeItemRequest'
    responses:
      '200':
        description: Предложение обновлено
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionItemsById:
  delete:
    tags:
      - TradeSessions
    summary: Удалить предмет из предложения
    description: |
      Удаляет предмет из текущего предложения. Если предмет заблокирован или
      предложение зафиксировано, возвращает конфликт.
    operationId: removeTradeSessionItem
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
      - $ref: '../schemas/index.yaml#/components/parameters/ItemEntryId'
    responses:
      '200':
        description: Предмет удалён и предложение обновлено
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionCurrency:
  post:
    tags:
      - TradeSessions
    summary: Обновить валюту в предложении
    description: |
      Устанавливает или изменяет валютное предложение стороны сделки. Поддерживает
      несколько валют и автоматически рассчитывает комиссии и налоги.
    operationId: updateTradeSessionCurrency
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/OfferTradeCurrencyRequest'
    responses:
      '200':
        description: Валюта обновлена
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionLock:
  post:
    tags:
      - TradeSessions
    summary: Зафиксировать предложение участника
    description: |
      Ставит предложение на lock-in, предотвращая изменения предметов и валюты до
      финального подтверждения или ручного разблокирования.
    operationId: lockTradeSession
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/LockTradeOfferRequest'
    responses:
      '200':
        description: Предложение зафиксировано
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionUnlock:
  post:
    tags:
      - TradeSessions
    summary: Снять блокировку предложения
    description: |
      Позволяет стороне отменить lock-in, если сделка требует корректировок.
      Ведёт журнал для расследований.
    operationId: unlockTradeSession
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/UnlockTradeOfferRequest'
    responses:
      '200':
        description: Предложение разблокировано
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionConfirm:
  post:
    tags:
      - TradeSessions
    summary: Финальное подтверждение сделки
    description: |
      Подтверждает завершение сделки со стороны участника. После подтверждения
      обеими сторонами запускается перевод предметов и валюты.
    operationId: confirmTradeSession
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/ConfirmTradeSessionRequest'
    responses:
      '200':
        description: Подтверждение принято
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '409':
        $ref: '../shared/common/responses.yaml#/components/responses/Conflict'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'
tradeSessionCancel:
  post:
    tags:
      - TradeSessions
    summary: Отменить торговую сессию
    description: |
      Завершает торговлю по инициативе игрока или системы. Освобождает предметы,
      логирует причину и уведомляет вторую сторону.
    operationId: cancelTradeSession
    parameters:
      - $ref: '../schemas/index.yaml#/components/parameters/SessionId'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/index.yaml#/components/schemas/CancelTradeSessionRequest'
    responses:
      '200':
        description: Торговая сессия отменена
        content:
          application/json:
            schema:
              $ref: '../schemas/index.yaml#/components/schemas/TradeSession'
      '400':
        $ref: '../shared/common/responses.yaml#/components/responses/BadRequest'
      '401':
        $ref: '../shared/common/responses.yaml#/components/responses/Unauthorized'
      '403':
        $ref: '../shared/common/responses.yaml#/components/responses/Forbidden'
      '404':
        $ref: '../shared/common/responses.yaml#/components/responses/NotFound'
      '422':
        $ref: '../shared/common/responses.yaml#/components/responses/UnprocessableEntity'
      '500':
        $ref: '../shared/common/responses.yaml#/components/responses/InternalServerError'

