# Архитектура директорий API-SWAGGER

**api-readiness:** not-applicable  
**api-readiness-check-date:** 2025-11-08  
**api-readiness-notes:** Служебный файл, описание архитектуры репозитория, не предназначен для создания API
**Последнее обновление:** 2025-11-08 - Добавлена информация о микросервисной архитектуре

## Предлагаемая структура

```
API-SWAGGER/
├── README.md                          # Описание репозитория
├── ARCHITECTURE.md                    # Этот документ - описание архитектуры
├── ДУАПИТАСК.MD                       # Инструкции для агента-создателя заданий
├── АПИТАСК.MD                         # Инструкции для агента-исполнителя заданий
│
├── .cursor/                           # Правила для AI агентов
│   └── rules/
│       ├── api-swagger-rules.mdc      # Общие правила работы с API
│       └── api-task-creator-rules.mdc # Правила для создателя заданий
│
├── api/                               # API спецификации
│   ├── v1/                            # Версия API v1
│   │   ├── gameplay/                  # Игровая механика
│   │   │   ├── README.md              # Обзор игровой механики
│   │   │   ├── combat/                # Боевая система
│   │   │   │   ├── README.md          # Обзор боевой системы
│   │   │   │   ├── shooting.yaml      # Механики шутера
│   │   │   │   ├── abilities.yaml      # Система способностей
│   │   │   │   ├── implants.yaml      # Импланты и модификации
│   │   │   │   ├── implants-limits.yaml # Ограничения имплантов
│   │   │   │   ├── cyberpsychosis.yaml # Киберпсихоз
│   │   │   │   ├── extraction.yaml    # Экстрактшутер механики
│   │   │   │   └── hacking.yaml       # Хакерские способности
│   │   │   ├── progression/           # Прокачка и развитие
│   │   │   │   ├── README.md          # Обзор прокачки
│   │   │   │   ├── skills.yaml        # Система навыков
│   │   │   │   ├── levels.yaml        # Уровни персонажа
│   │   │   │   ├── classes.yaml       # Классы персонажей
│   │   │   │   └── perks.yaml         # Перки и таланты
│   │   │   ├── economy/               # Экономика
│   │   │   │   ├── README.md          # Обзор экономики
│   │   │   │   ├── trading.yaml       # Торговля
│   │   │   │   ├── crafting.yaml      # Крафт
│   │   │   │   ├── equipment-matrix.yaml # Матрица снаряжения
│   │   │   │   └── currencies.yaml    # Валюты и ресурсы
│   │   │   ├── social/                # Социальные механики
│   │   │   │   ├── README.md          # Обзор социальных механик
│   │   │   │   ├── guilds.yaml        # Кланы и гильдии
│   │   │   │   ├── relationships.yaml # Отношения с NPC
│   │   │   │   ├── personal-npc-tool.yaml # Персональные NPC
│   │   │   │   └── mentorship.yaml    # Система менторства
│   │   │   └── world/                 # Игровой мир
│   │   │       ├── README.md          # Обзор игрового мира
│   │   │       ├── events.yaml        # Мировые события
│   │   │       ├── raids.yaml         # Рейды
│   │   │       └── building.yaml      # Строительство
│   │   ├── lore/                      # Лор и сеттинг
│   │   │   ├── README.md              # Обзор лора
│   │   │   ├── factions.yaml          # Фракции
│   │   │   ├── locations.yaml        # Локации
│   │   │   ├── characters.yaml        # Персонажи
│   │   │   └── universe.yaml          # Вселенная CYBERPUNK
│   │   └── narrative/                 # Повествование
│   │       ├── README.md              # Обзор повествования
│   │       ├── quests.yaml            # Система квестов
│   │       ├── dialogues.yaml         # Диалоги
│   │       └── romances.yaml          # Романтические линии
│   └── shared/                        # Общие компоненты
│       ├── README.md                  # Обзор общих компонентов
│       ├── common/                    # Общие модели и схемы
│       │   ├── responses.yaml         # Стандартные ответы
│       │   ├── errors.yaml            # Стандартные ошибки
│       │   ├── pagination.yaml        # Пагинация
│       │   └── filters.yaml           # Фильтры
│       └── security/                  # Безопасность
│           ├── authentication.yaml    # Аутентификация
│           └── authorization.yaml     # Авторизация
│
├── tasks/                             # Система заданий для агентов
│   ├── README.md                      # Обзор системы заданий
│   ├── templates/                     # Шаблоны заданий
│   │   └── api-generation-task-template.md # Шаблон задания
│   ├── config/                        # Конфигурация системы заданий
│   │   ├── task-creation-guide.md     # Инструкция создания заданий
│   │   ├── checklist.md               # Чеклист проверки задания
│   │   └── brain-mapping.yaml         # Маппинг .BRAIN -> задания
│   ├── active/                        # Активные задания
│   │   ├── queue/                     # Очередь заданий (готовы к выполнению)
│   │   │   └── task-XXX-description.md
│   │   └── in-progress/               # Задания в работе
│   │       └── task-XXX-description.md
│   └── completed/                     # Завершенные задания
│       └── YYYY-MM-DD/                # По датам
│           └── task-XXX-description.md
│
└── scripts/                           # Скрипты для работы
    ├── autocommit.ps1                 # Автокоммит для Windows
    └── autocommit.sh                  # Автокоммит для Linux/Mac
```

## Принципы организации

### 1. Версионирование API
- Каждая версия API в отдельной директории (`v1/`, `v2/`, и т.д.)
- Структура повторяется для каждой версии
- При создании новой версии - копировать структуру из предыдущей
- Версионирование через `info.version` в файлах OpenAPI

### 2. Иерархическая структура
- От общего к частному
- Каждая категория имеет `README.md` с обзором
- Детализация в подкаталогах
- Соответствие структуре `.BRAIN` репозитория

### 3. Именование файлов
- **Файлы API:** `kebab-case.yaml` (например: `personal-npc-tool.yaml`)
- **Директории:** `kebab-case` (например: `gameplay/`, `combat/`)
- **Модели в API:** `PascalCase` (например: `PersonalNPC`, `Weapon`)
- **Endpoints:** `kebab-case` (например: `/api/v1/gameplay/social/npc`)

### 4. Ограничение размера файлов
- **МАКСИМУМ 400 строк на файл**
- Если файл превышает 400 строк - разбить на несколько файлов
- Логическое разбиение: по группам endpoints (CRUD, операции, управление)
- Примеры именования при разбиении:
  - `personal-npc-tool.yaml` (основные endpoints, до 400 строк)
  - `personal-npc-tool-contracts.yaml` (контракты, до 400 строк)
  - `personal-npc-tool-licenses.yaml` (лицензии, до 400 строк)

### 5. Связи с .BRAIN
- Каждый API файл должен иметь ссылки на оригинальные документы .BRAIN
- В `info.description` указывать путь к документу .BRAIN с версией
- В комментариях к endpoints и моделям указывать ссылки на соответствующие секции документа .BRAIN

### 6. Версионирование документов
- История изменений в Git
- Коммиты после каждого значимого изменения
- Семантическое версионирование API (`info.version`)

### 7. Документация
- Каждая директория имеет `README.md` с обзором содержимого
- Описание структуры и назначения директории
- Примеры использования API из директории

## Соответствие структуре .BRAIN и Backend микросервисам

Структура API-SWAGGER соответствует структуре `.BRAIN` и распределяется по Backend микросервисам:

| .BRAIN | API-SWAGGER | Backend микросервис |
|--------|-------------|---------------------|
| `02-gameplay/` | `api/v1/gameplay/` | Различные сервисы |
| `02-gameplay/combat/` | `api/v1/gameplay/combat/` | gameplay-service (8083) |
| `02-gameplay/progression/` | `api/v1/gameplay/progression/` | gameplay-service (8083) |
| `02-gameplay/economy/` | `api/v1/gameplay/economy/` | economy-service (8085) |
| `02-gameplay/social/` | `api/v1/gameplay/social/` | social-service (8084) |
| `02-gameplay/world/` | `api/v1/gameplay/world/` | world-service (8086) |
| `03-lore/` | `api/v1/lore/` | world-service (8086) |
| `03-lore/factions/` | `api/v1/lore/factions.yaml` | world-service (8086) |
| `03-lore/locations/` | `api/v1/lore/locations.yaml` | world-service (8086) |
| `03-lore/characters/` | `api/v1/lore/characters.yaml` | character-service (8082) |
| `04-narrative/` | `api/v1/narrative/` | narrative-service (8087) |

**Метаданные микросервисов в OpenAPI:**

Каждый API файл должен содержать метаданные о целевом микросервисе:

```yaml
info:
  x-microservice:
    name: gameplay-service
    port: 8083
    domain: gameplay
    base-path: /api/v1/gameplay/combat
    package: com.necpgame.gameplayservice
```

Скрипт генерации `generate-openapi-microservices.ps1` использует эти метаданные для определения целевого микросервиса.

## Рабочий процесс

1. **Создание задания** → Агент-создатель читает `.BRAIN` и создает задание
2. **Выполнение задания** → Агент-исполнитель создает API спецификацию
3. **Коммит изменений** → ОБЯЗАТЕЛЬНО делать коммит после работы с файлами
4. **Обновление маппинга** → Обновить `brain-mapping.yaml`
5. **Перемещение задания** → Переместить в `tasks/completed/`

## Версионирование и история

- **Git коммиты:** ОБЯЗАТЕЛЬНО делать коммит после каждого значимого изменения
- **История изменений:** Отслеживается через Git
- **Версионирование API:** Через `info.version` в OpenAPI спецификациях
- **Семантическое версионирование:** MAJOR.MINOR.PATCH (1.0.0, 1.1.0, 2.0.0)

## Контроль действий агентов

Для лучшего контроля действий агентов:

1. **Следование структуре:** Агенты ОБЯЗАНЫ следовать установленной иерархии директорий
2. **Проверка размера:** Каждый файл не должен превышать 400 строк
3. **Коммиты:** ОБЯЗАТЕЛЬНО делать коммиты после работы для сохранения истории
4. **Документация:** Все изменения должны быть задокументированы
5. **Валидация:** Все API спецификации должны быть валидными OpenAPI 3.0.3
6. **Ссылки:** Все API должны иметь ссылки на оригинальные документы .BRAIN

---

**ВНИМАНИЕ:** Все агенты ОБЯЗАНЫ следовать этой архитектуре. Отклонения от структуры не допускаются без явного указания пользователя.

