# АПИТАСК.MD

**Файл для передачи AI агенту (API Executor) для создания API спецификаций по заданиям**

---

## Что это?

Этот файл содержит ссылки на правила и инструкции для AI агента, который создает API спецификации на основе заданий из `tasks/active/queue/`.

**Минимальный вход для работы агента:**
1. Этот файл (АПИТАСК.MD)
2. ПРАВИЛО: `API-SWAGGER/.cursor/rules/api-swagger-rules.mdc` (уже включено автоматически)
3. ЗАДАНИЕ: файл задания из `API-SWAGGER/tasks/active/queue/task-XXX-description.md`

**Дополнительная информация (опционально):**
- `.BRAIN/02-gameplay/*` - исходные документы для дополнительного контекста (но задание должно быть самодостаточным)
- Существующие API: `API-SWAGGER/api/v1/*` - примеры существующих API для стиля и формата

---

## Ссылки на правила и документацию

### Правила работы

**Файл:** `API-SWAGGER/.cursor/rules/api-swagger-rules.mdc`

**Содержит:**
- Репозиторий API-SWAGGER: централизованная API документация в формате OpenAPI/Swagger
- Принцип API FIRST: сначала спецификация, потом реализация
- Версионирование API: семантическое версионирование
- Документация: все endpoints, модели данных, схемы запросов и ответов
- RESTful API: стандартные HTTP методы и коды ответов
- Принципы проекта: SOLID, DRY, KISS
- Описание игры и лора

**Читать:** [Правила работы](./.cursor/rules/api-swagger-rules.mdc)

---

## Как использовать

### Вариант 1: Одно задание из очереди

**Команда:**
```
Делай API для tasks/active/queue/task-001-personal-npc-tool-api.md
```

**Что делает агент:**
1. Читает этот файл (АПИТАСК.MD)
2. Читает правила из `api-swagger-rules.mdc`
3. Читает задание из `tasks/active/queue/task-001-personal-npc-tool-api.md`
4. Создает API спецификацию по заданию
5. Проверяет по критериям приемки из задания
6. Сохраняет API спецификацию в указанном месте (`api/v1/.../file.yaml`)
7. Обновляет статус задания в `brain-mapping.yaml`
8. Перемещает задание в `tasks/completed/`

---

### Вариант 2: Несколько заданий из очереди

**Команда:**
```
Делай API для всех заданий из tasks/active/queue/
```

**Что делает агент:**
1. Читает этот файл (АПИТАСК.MD)
2. Читает правила из `api-swagger-rules.mdc`
3. Читает ВСЕ задания из `tasks/active/queue/`
4. Для каждого задания:
   - Создает API спецификацию по заданию
   - Проверяет по критериям приемки
   - Сохраняет API спецификацию
   - Обновляет статус в `brain-mapping.yaml`
   - Перемещает задание в `tasks/completed/`
5. Учитывает зависимости между заданиями (если указаны)

---

### Вариант 3: Конкретное задание по ID

**Команда:**
```
Делай API для задания API-TASK-001
```

**Что делает агент:**
1. Читает этот файл (АПИТАСК.MD)
2. Читает правила из `api-swagger-rules.mdc`
3. Находит задание по ID в `brain-mapping.yaml` или ищет в `tasks/active/queue/`
4. Читает задание
5. Создает API спецификацию по заданию
6. Проверяет по критериям приемки
7. Сохраняет API спецификацию
8. Обновляет статус в `brain-mapping.yaml`
9. Перемещает задание в `tasks/completed/`

---

## Процесс работы агента

### Шаг 1: Чтение правил и задания

Агент должен:
1. Прочитать `API-SWAGGER/.cursor/rules/api-swagger-rules.mdc` - понять правила работы с API
2. Прочитать задание из `tasks/active/queue/task-XXX-description.md` полностью
3. Понять структуру задания: метаданные, источники, план, endpoints, модели, критерии приемки
4. (Опционально) Проверить существующие API в `api/v1/` для примеров стиля и формата

### Шаг 2: Анализ задания

Агент должен:
1. Извлечь из задания:
   - Целевой путь к API файлу (`api/v1/gameplay/social/personal-npc-tool.yaml`)
   - Все endpoints с методами, путями, параметрами, ответами
   - Все модели данных с полями, типами, валидацией
   - Принципы и правила из задания
   - Критерии приемки
   - Примеры из задания
2. Проверить зависимости:
   - Есть ли зависимости от других заданий?
   - Нужно ли ждать выполнения других заданий?
   - Есть ли связанные API, которые должны существовать?

### Шаг 3: Создание API спецификации

Агент должен:
1. **Определить необходимость разбиения файла:**
   - Проверить количество endpoints и моделей из задания
   - Если файл будет больше 400 строк - разбить на несколько файлов
   - Логическое разбиение: по группам endpoints (CRUD, операции, управление и т.д.)
   - Примеры разбиения:
     - `personal-npc-tool.yaml` (основные endpoints)
     - `personal-npc-tool-contracts.yaml` (контракты)
     - `personal-npc-tool-licenses.yaml` (лицензии)
   - Создать главный файл с ссылками на остальные через `$ref` или README с описанием структуры

2. **Создать структуру OpenAPI 3.0.3:**
   ```yaml
   openapi: 3.0.3
   info:
     title: ...
     version: 1.0.0  # Версия API (семантическое версионирование)
     description: |
       # Описание API
       
       ## Источник концепции
       - Оригинальный документ: `.BRAIN/02-gameplay/social/personal-npc-tool.md`
       - Версия документа: v1.0.0
       - Задание: `API-SWAGGER/tasks/active/queue/task-001-personal-npc-tool-api.md`
       - Task ID: API-TASK-001
       
       ## Комментарии для исполнителя
       - Этот API описывает систему персональных NPC
       - Все данные хранятся в БД PostgreSQL
       - Валидация выполняется на бекенде
   servers:
     - url: https://api.necp.game/v1
       description: Production server
   paths:
     # Все endpoints здесь
   components:
     schemas:
       # Все модели здесь
     responses:
       # Стандартные ответы
     securitySchemes:
       # Схемы безопасности
   ```

3. **Добавить инлайн комментарии для исполнителя:**
   - В начале файла: ссылки на оригинальные документы (.BRAIN) и задание
   - В секции `info.description`: комментарии о назначении API, источниках, версиях
   - В секциях `paths`: комментарии о бизнес-логике endpoints (если нужно)
   - В секциях `components.schemas`: комментарии о моделях данных
   - Использовать формат:
     ```yaml
     # Комментарий для исполнителя: пояснение кода ниже
     # Источник: .BRAIN/02-gameplay/social/personal-npc-tool.md (v1.0.0)
     ```

4. **Создать все endpoints из задания:**
   - Для каждого endpoint: метод, путь, описание, параметры, request body, responses
   - Все коды ответов (200, 400, 401, 403, 404, 409, 422, 500)
   - Все примеры запросов/ответов из задания
   - Добавить комментарии к сложным endpoints с пояснениями бизнес-логики

5. **Создать все модели данных из задания:**
   - Для каждой модели: все поля, типы, валидация, required/optional
   - Все enum значения с описаниями
   - Все примеры из задания
   - Добавить комментарии к моделям с ссылками на оригинальные документы

6. **Добавить документацию и ссылки:**
   - Описание для каждого endpoint
   - Описание для каждой модели и поля
   - Описание всех enum значений
   - Примеры использования
   - **Ссылки на оригинальные файлы:**
     - В `info.description`: ссылка на документ .BRAIN
     - В комментариях к endpoints: ссылки на соответствующие секции документа .BRAIN
     - В комментариях к моделям: ссылки на определения моделей в документе .BRAIN

7. **Проверить размер файла:**
   - После создания файла проверить количество строк
   - Если файл больше 400 строк - разбить на несколько файлов
   - Логически разделить endpoints и модели между файлами
   - Создать главный файл или README с описанием структуры разбиения

### Шаг 4: Валидация и проверка

Агент должен:
1. **Проверить размер файлов:**
   - Каждый файл не должен превышать 400 строк
   - Если файл больше 400 строк - разбить на несколько файлов
   - Убедиться, что разбиение логично и все связи сохранены

2. **Проверить версионирование:**
   - В `info.version` указана версия API (семантическое версионирование: 1.0.0, 1.1.0, 2.0.0)
   - Версия соответствует версии документа .BRAIN (если указана в задании)
   - При обновлении API - увеличивать версию согласно семантическому версионированию

3. **Проверить ссылки на оригинальные файлы:**
   - В `info.description` есть ссылка на документ .BRAIN
   - В комментариях к endpoints есть ссылки на соответствующие секции документа .BRAIN
   - В комментариях к моделям есть ссылки на определения моделей в документе .BRAIN

4. **Проверить инлайн комментарии:**
   - Все комментарии для исполнителя добавлены
   - Комментарии поясняют сложные места и бизнес-логику
   - Комментарии содержат ссылки на оригинальные документы

5. Проверить синтаксис YAML (нет ошибок)
6. Проверить валидность OpenAPI 3.0.3 спецификации (можно через Swagger Editor онлайн)
7. Проверить по критериям приемки из задания:
   - Файл(ы) создан(ы) по указанному пути
   - Все endpoints включены
   - Все модели включены
   - Все элементы задокументированы
   - Все примеры включены
   - Все валидации указаны
8. Проверить соответствие принципам проекта:
   - SOLID, DRY, KISS
   - RESTful API
   - Версионирование
   - Стиль кодирования из задания

### Шаг 5: Обновление статуса задания

Агент должен:
1. Открыть `API-SWAGGER/tasks/config/brain-mapping.yaml`
2. Найти запись для задания по task_id
3. Обновить статус на `completed`:
   ```yaml
   mappings:
     - source: ".BRAIN/02-gameplay/social/personal-npc-tool.md"
       target: "api/v1/gameplay/social/personal-npc-tool.yaml"
       task_id: "API-TASK-001"
       status: "completed"  # Было: queued
       updated: "2025-11-03 21:00"
       completed: "2025-11-03 21:00"
   ```
4. Переместить задание из `tasks/active/queue/` в `tasks/completed/YYYY-MM-DD/` (создать директорию по дате, если не существует)

### Шаг 6: Финализация

Агент должен:
1. Проверить, что API спецификация создана и сохранена
2. Проверить, что статус задания обновлен в `brain-mapping.yaml`
3. Проверить, что задание перемещено в `tasks/completed/`
4. Убедиться, что API спецификация валидна и соответствует заданию
5. **Проверить соответствие архитектуре:** Целевой путь API соответствует иерархии директорий из `ARCHITECTURE.md`
6. **ОБЯЗАТЕЛЬНО сделать коммит** для сохранения истории работы

### Шаг 7: Коммит изменений

**ОБЯЗАТЕЛЬНО:** После завершения работы над заданием нужно сделать коммит для сохранения истории и лучшего контроля действий агентов.

Агент должен:
1. Использовать скрипт автокоммита: `scripts/autocommit.ps1` (Windows) или `scripts/autocommit.sh` (Linux/Mac)
2. Выполнить команду из корня репозитория:
   ```bash
   # Windows
   .\scripts\autocommit.ps1 "Создана API спецификация для task-XXX"
   
   # Linux/Mac
   ./scripts/autocommit.sh "Создана API спецификация для task-XXX"
   ```
3. Если сообщение не указано, скрипт сгенерирует его автоматически на основе измененных файлов
4. Коммит должен включать:
   - Созданную API спецификацию (в `api/v1/.../`)
   - Обновленный `brain-mapping.yaml`
   - Перемещенное задание (в `tasks/completed/`)

**Зачем это нужно:**
- Сохранение истории работы агентов
- Возможность отслеживания изменений
- Лучший контроль действий агентов
- Возможность отката изменений при необходимости

---

## Обязательные элементы API спецификации

Каждая созданная API спецификация должна содержать:

1. **Версионирование:**
   - `info.version` - версия API (семантическое версионирование: 1.0.0, 1.1.0, 2.0.0)
   - Версия должна соответствовать версии документа .BRAIN (если указана в задании)
   - При обновлении API - увеличивать версию согласно семантическому версионированию
   - Формат версии: `MAJOR.MINOR.PATCH` (например: 1.0.0, 1.1.0, 2.0.0)

2. **Размер файлов:**
   - **МАКСИМУМ 400 строк на файл**
   - Если файл превышает 400 строк - ОБЯЗАТЕЛЬНО разбить на несколько файлов
   - Логическое разбиение: по группам endpoints (CRUD, операции, управление и т.д.)
   - Создать главный файл с ссылками на остальные или README с описанием структуры
   - Примеры именования при разбиении:
     - `personal-npc-tool.yaml` (основные endpoints, до 400 строк)
     - `personal-npc-tool-contracts.yaml` (контракты, до 400 строк)
     - `personal-npc-tool-licenses.yaml` (лицензии, до 400 строк)

3. **Инлайн комментарии для исполнителя:**
   - В начале файла (в `info.description`): комментарии о назначении API, источниках, версиях
   - В секциях `paths`: комментарии к сложным endpoints с пояснениями бизнес-логики
   - В секциях `components.schemas`: комментарии к моделям данных с пояснениями
   - Формат комментариев:
     ```yaml
     # Комментарий для исполнителя: пояснение кода ниже
     # Источник: .BRAIN/02-gameplay/social/personal-npc-tool.md (v1.0.0)
     ```
   - Комментарии должны быть полезными и пояснять:
     - Назначение кода
     - Бизнес-логику (если неочевидно)
     - Ограничения и валидации
     - Связи с другими API или системами

4. **Ссылки на оригинальные файлы:**
   - В `info.description`: полная ссылка на документ .BRAIN с версией
   - В комментариях к endpoints: ссылки на соответствующие секции документа .BRAIN
   - В комментариях к моделям: ссылки на определения моделей в документе .BRAIN
   - Формат ссылок:
     ```yaml
     # Источник: .BRAIN/02-gameplay/social/personal-npc-tool.md (v1.0.0)
     # Раздел: Модели данных -> PersonalNPC
     # Задание: API-SWAGGER/tasks/active/queue/task-001-personal-npc-tool-api.md
     ```
   - Все ссылки должны быть полными и указывать на конкретные секции документа

5. **OpenAPI 3.0.3 структура:**
   - `openapi: 3.0.3` - версия OpenAPI
   - `info` - информация об API (title, version, description со ссылками)
   - `servers` - серверы (Production server URL)
   - `paths` - все endpoints
   - `components` - схемы, responses, security schemes

6. **Все endpoints из задания:**
   - HTTP метод (GET, POST, PUT, DELETE, PATCH)
   - Путь (`/api/v1/gameplay/social/npc`)
   - Summary и description
   - Parameters (path, query, header)
   - Request body (если есть)
   - Responses (200, 400, 401, 403, 404, 409, 422, 500)
   - Examples для запросов/ответов
   - Tags для группировки

7. **Все модели данных из задания:**
   - Type (object, string, integer, number, boolean, array)
   - Properties (все поля)
   - Required (обязательные поля)
   - Validation (min, max, enum, format, pattern)
   - Description для каждого поля
   - Example для каждой модели

8. **Документация:**
   - Description для каждого endpoint
   - Description для каждой модели и поля
   - Description для всех enum значений
   - Примеры использования
   - Описание ошибок

9. **Валидация:**
   - Все параметры имеют валидацию
   - Все поля моделей имеют валидацию
   - Все enum имеют описание значений

10. **Обработка ошибок:**
    - Все возможные ошибки описаны
    - Коды ошибок: 400 (Bad Request), 401 (Unauthorized), 403 (Forbidden), 404 (Not Found), 409 (Conflict), 422 (Unprocessable Entity), 500 (Internal Server Error)
    - Примеры ответов с ошибками

---

## Принципы работы

1. **Следование заданию:** API спецификация должна точно соответствовать заданию - все endpoints и модели из задания должны быть реализованы

2. **Самодостаточность:** Задание содержит всю информацию для работы, не нужно обращаться к .BRAIN документам (но можно для дополнительного контекста)

3. **Валидность:** API спецификация должна быть валидной OpenAPI 3.0.3 - проверить через Swagger Editor

4. **Полнота:** Все элементы из задания должны быть реализованы - endpoints, модели, примеры, документация

5. **Соответствие принципам:** API должно соответствовать принципам проекта (SOLID, DRY, KISS, API First, RESTful)

6. **Версионирование:** ОБЯЗАТЕЛЬНО вести версионирование API через `info.version` (семантическое версионирование: 1.0.0, 1.1.0, 2.0.0)

7. **Ограничение размера:** Каждый файл API не должен превышать 400 строк. Если больше - ОБЯЗАТЕЛЬНО разбить на несколько файлов с логической структурой

8. **Инлайн комментарии:** Добавлять полезные комментарии для исполнителя (бекенд разработчика), поясняющие назначение, бизнес-логику, ограничения

9. **Ссылки на оригиналы:** Везде, где возможно, добавлять ссылки на оригинальные документы .BRAIN с указанием версий и конкретных секций

---

## Примеры команд

### Пример 1: Одно задание
```
Делай API для tasks/active/queue/task-001-personal-npc-tool-api.md
```

### Пример 2: Все задания
```
Делай API для всех заданий из tasks/active/queue/
```

### Пример 3: По ID задания
```
Делай API для задания API-TASK-001
```

### Пример 4: Несколько конкретных заданий
```
Делай API для:
- tasks/active/queue/task-001-personal-npc-tool-api.md
- tasks/active/queue/task-002-equipment-matrix-api.md
```

### Пример 5: С приоритетом
```
Делай API для всех заданий с приоритетом "высокий" из tasks/active/queue/
```

---

## Архитектура и иерархия директорий

**ВАЖНО:** Агент ОБЯЗАН следовать установленной архитектуре и иерархии директорий для лучшего контроля действий и получения лучшего результата.

**Полное описание архитектуры:** `API-SWAGGER/ARCHITECTURE.md`

### Основные принципы архитектуры:

1. **Версионирование API:** Каждая версия API в отдельной директории (`v1/`, `v2/`, и т.д.)
2. **Иерархическая структура:** От общего к частному, соответствие структуре `.BRAIN`
3. **Именование:** Файлы - `kebab-case.yaml`, директории - `kebab-case`, модели - `PascalCase`
4. **Ограничение размера:** МАКСИМУМ 400 строк на файл, если больше - разбить на несколько
5. **Связи с .BRAIN:** Каждый API должен иметь ссылки на оригинальные документы .BRAIN
6. **Документация:** Каждая директория должна иметь `README.md` с обзором

### Структура директорий API:

```
api/v1/
├── gameplay/                  # Игровая механика
│   ├── combat/                # Боевая система
│   ├── progression/           # Прокачка и развитие
│   ├── economy/               # Экономика
│   ├── social/                # Социальные механики
│   └── world/                 # Игровой мир
├── lore/                      # Лор и сеттинг
│   ├── factions.yaml
│   ├── locations.yaml
│   ├── characters.yaml
│   └── universe.yaml
├── narrative/                 # Повествование
│   ├── quests.yaml
│   ├── dialogues.yaml
│   └── romances.yaml
└── shared/                    # Общие компоненты
    ├── common/                # Общие модели и схемы
    └── security/               # Безопасность
```

**Соответствие .BRAIN:**
- `.BRAIN/02-gameplay/` → `api/v1/gameplay/`
- `.BRAIN/03-lore/` → `api/v1/lore/`
- `.BRAIN/04-narrative/` → `api/v1/narrative/`

**ВАЖНО:** При определении целевого пути API из задания нужно проверять соответствие этой структуре. Если путь не соответствует - исправить его согласно архитектуре.

### Структура файлов

```
API-SWAGGER/
├── ARCHITECTURE.md                # Описание архитектуры (ВАЖНО!)
├── АПИТАСК.MD                      # Этот файл
├── ДУАПИТАСК.MD                    # Файл для создания заданий
├── .cursor/
│   └── rules/
│       └── api-swagger-rules.mdc  # Правила работы с API
├── api/
│   └── v1/                         # Версия API
│       ├── gameplay/               # Игровая механика
│       │   ├── combat/
│       │   ├── progression/
│       │   ├── economy/
│       │   ├── social/
│       │   └── world/
│       ├── lore/                   # Лор и сеттинг
│       ├── narrative/               # Повествование
│       └── shared/                  # Общие компоненты
├── tasks/
│   ├── active/
│   │   ├── queue/                    # Очередь заданий (отсюда берем задания)
│   │   │   └── task-XXX-description.md
│   │   └── in-progress/              # Задания в работе
│   └── completed/                    # Сюда перемещаем после выполнения
│       └── YYYY-MM-DD/
│           └── task-XXX-description.md
├── tasks/config/
│   └── brain-mapping.yaml            # Обновляем статус задания здесь
└── scripts/
    ├── autocommit.ps1                # Скрипт автокоммита (Windows)
    └── autocommit.sh                 # Скрипт автокоммита (Linux/Mac)
```

---

## Важные файлы для агента

**Обязательно прочитать:**
1. `API-SWAGGER/.cursor/rules/api-swagger-rules.mdc` - правила работы с API
2. Файл задания из `tasks/active/queue/task-XXX-description.md` - полное задание

**Использовать:**
- `API-SWAGGER/tasks/config/brain-mapping.yaml` - обновлять статус задания после выполнения
- `API-SWAGGER/api/v1/*` - примеры существующих API (для стиля, если есть)

**Результат:**
- `API-SWAGGER/api/v1/.../file.yaml` - созданная API спецификация
- `API-SWAGGER/tasks/completed/YYYY-MM-DD/task-XXX-description.md` - выполненное задание

---

## Контрольный список для агента

Перед началом работы:
- [ ] Прочитал `api-swagger-rules.mdc`
- [ ] Прочитал задание полностью
- [ ] Понял все endpoints из задания
- [ ] Понял все модели данных из задания
- [ ] Проверил зависимости (если есть)
- [ ] Понял критерии приемки

После создания API спецификации:
- [ ] Файл(ы) создан(ы) по указанному пути в задании
- [ ] Целевой путь соответствует архитектуре директорий из `ARCHITECTURE.md`
- [ ] Каждый файл не превышает 400 строк (если больше - разбито на несколько файлов)
- [ ] Версионирование указано в `info.version` (семантическое версионирование)
- [ ] В `info.description` есть ссылки на оригинальные документы .BRAIN
- [ ] Инлайн комментарии для исполнителя добавлены (к сложным местам)
- [ ] Ссылки на оригинальные файлы .BRAIN добавлены везде, где возможно
- [ ] OpenAPI 3.0.3 структура корректна
- [ ] Все endpoints из задания реализованы
- [ ] Все модели данных из задания реализованы
- [ ] Все элементы задокументированы
- [ ] Все примеры включены
- [ ] Все валидации указаны
- [ ] Все ошибки описаны
- [ ] API спецификация валидна (проверено через Swagger Editor)
- [ ] Соответствует критериям приемки из задания
- [ ] Проверено соответствие структуре `.BRAIN` → `API-SWAGGER`
- [ ] Обновлен статус в `brain-mapping.yaml`
- [ ] Задание перемещено в `tasks/completed/`
- [ ] **Сделан коммит** изменений (для сохранения истории)

---

## Критерии приемки (общие)

API спецификация считается выполненной, если:

1. ✅ **Файл(ы) создан(ы):** API спецификация существует по указанному пути
2. ✅ **Размер файлов:** Каждый файл не превышает 400 строк (если больше - разбито на несколько файлов)
3. ✅ **Версионирование:** Версия API указана в `info.version` (семантическое версионирование)
4. ✅ **Ссылки на оригиналы:** В `info.description` есть ссылки на оригинальные документы .BRAIN с версиями
5. ✅ **Инлайн комментарии:** Добавлены полезные комментарии для исполнителя (к сложным местам, бизнес-логике)
6. ✅ **Ссылки в комментариях:** В комментариях к endpoints и моделям есть ссылки на соответствующие секции документа .BRAIN
7. ✅ **OpenAPI валидный:** Файл(ы) проходят валидацию OpenAPI 3.0.3
8. ✅ **Все endpoints:** Все endpoints из задания описаны
9. ✅ **Все модели:** Все модели данных из задания описаны
10. ✅ **Документация:** Все элементы задокументированы
11. ✅ **Примеры:** Примеры запросов/ответов включены
12. ✅ **Валидация:** Все параметры имеют валидацию
13. ✅ **Ошибки:** Все возможные ошибки описаны
14. ✅ **Соответствие заданию:** API соответствует заданию (все требования выполнены)
15. ✅ **Соответствие принципам:** API соответствует принципам проекта

---

## Типичные проблемы и решения

**Q: Что делать, если в задании не хватает деталей?**
A: Задание должно быть самодостаточным. Если чего-то не хватает, используй принципы проекта и существующие примеры API (если есть). Можно также проверить исходный документ .BRAIN для контекста, но решение должно основываться на задании.

**Q: Как обрабатывать зависимости от других заданий?**
A: Проверь статус зависимых заданий в `brain-mapping.yaml`. Если зависимость еще не выполнена:
- Можно создать базовую структуру API с пометками о зависимостях
- Или создать API частично, оставив ссылки на будущие API
- Или подождать выполнения зависимостей (сообщить пользователю)

**Q: Что делать, если задание противоречит правилам проекта?**
A: Задание имеет приоритет, но если есть явные противоречия:
- Следуй заданию
- Добавь комментарии в API спецификацию о потенциальных проблемах
- Сообщи пользователю о противоречиях в истории выполнения задания

**Q: Нужно ли создавать директории, если их нет?**
A: Да, создавай все необходимые директории для целевого файла API. Например, если путь `api/v1/gameplay/social/personal-npc-tool.yaml`, но директории `api/v1/gameplay/social/` нет - создай её.

**Q: Как обрабатывать опциональные поля?**
A: В OpenAPI спецификации четко указывай:
- `required: []` для полей модели (список обязательных полей)
- Поля не в списке `required` считаются опциональными
- Добавляй `nullable: true` если поле может быть null

**Q: Что делать с бизнес-логикой?**
A: API спецификация описывает интерфейс, а не реализацию. Бизнес-логика будет в бекенде. В API опиши:
- Что принимает API (параметры, request body)
- Что возвращает API (responses)
- Валидацию данных
- Коды ошибок и их причины
- Но не описывай детальную логику обработки (это будет в реализации)
- Используй инлайн комментарии для пояснения сложных моментов бизнес-логики

**Q: Как обрабатывать версионирование?**
A: ОБЯЗАТЕЛЬНО веди версионирование через `info.version`:
- Используй семантическое версионирование (MAJOR.MINOR.PATCH)
- Версия должна соответствовать версии документа .BRAIN (если указана в задании)
- При обновлении API:
  - MAJOR (2.0.0) - breaking changes
  - MINOR (1.1.0) - новые функции, обратно совместимые
  - PATCH (1.0.1) - исправления багов, обратно совместимые
- Указывай версию в `info.description` с комментариями об изменениях

**Q: Что делать, если файл превышает 400 строк?**
A: ОБЯЗАТЕЛЬНО разбей файл на несколько файлов:
1. Определи логические группы endpoints и моделей
2. Разбей по группам (например: CRUD, операции, управление)
3. Создай несколько файлов с именами:
   - `main-file.yaml` (основные endpoints, до 400 строк)
   - `main-file-contracts.yaml` (контракты, до 400 строк)
   - `main-file-licenses.yaml` (лицензии, до 400 строк)
4. Создай главный файл или README с описанием структуры разбиения
5. Используй `$ref` для ссылок между файлами (если нужно)
6. Убедись, что каждый файл не превышает 400 строк

**Q: Какие комментарии добавлять?**
A: Добавляй полезные комментарии для исполнителя (бекенд разработчика):
- В `info.description`: назначение API, источники, версии
- К сложным endpoints: пояснения бизнес-логики, ограничения
- К моделям данных: пояснения полей, валидации, ограничения
- Формат: `# Комментарий для исполнителя: пояснение`
- Всегда добавляй ссылки на оригинальные документы .BRAIN

**Q: Как оформлять ссылки на оригинальные файлы?**
A: Добавляй ссылки везде, где возможно:
- В `info.description`: полная ссылка на документ .BRAIN с версией и заданием
- В комментариях к endpoints: ссылки на соответствующие секции документа .BRAIN
- В комментариях к моделям: ссылки на определения моделей в документе .BRAIN
- Формат:
  ```yaml
  # Источник: .BRAIN/02-gameplay/social/personal-npc-tool.md (v1.0.0)
  # Раздел: Модели данных -> PersonalNPC
  # Задание: API-SWAGGER/tasks/active/queue/task-001-personal-npc-tool-api.md
  ```

---

## Инструменты для проверки

**Валидация OpenAPI:**
- [Swagger Editor](https://editor.swagger.io/) - онлайн валидатор OpenAPI
- [Swagger Validator](https://validator.swagger.io/) - валидация API спецификации

**Примеры команд для проверки:**
```bash
# Проверка синтаксиса YAML (если установлен yamllint)
yamllint api/v1/gameplay/social/personal-npc-tool.yaml

# Проверка через npm swagger-cli (если установлен)
swagger-cli validate api/v1/gameplay/social/personal-npc-tool.yaml
```

---

## Архитектура и иерархия директорий

**ВАЖНО:** Агент ОБЯЗАН следовать установленной архитектуре и иерархии директорий. Полное описание в `API-SWAGGER/ARCHITECTURE.md`.

**Основные принципы:**
- Структура API соответствует структуре `.BRAIN`
- Каждая директория имеет `README.md` с обзором
- Файлы API не должны превышать 400 строк
- Именование: файлы - `kebab-case.yaml`, модели - `PascalCase`
- Каждый API должен иметь ссылки на оригинальные документы .BRAIN
- При определении целевого пути из задания - проверить соответствие архитектуре

## Коммиты и сохранение истории

**ОБЯЗАТЕЛЬНО:** После завершения работы над заданием нужно сделать коммит для сохранения истории и лучшего контроля действий агентов.

**Использование скрипта автокоммита:**
```bash
# Windows
.\scripts\autocommit.ps1 "Сообщение коммита"

# Linux/Mac
./scripts/autocommit.sh "Сообщение коммита"
```

**Если сообщение не указано**, скрипт сгенерирует его автоматически на основе измененных файлов.

**Зачем это нужно:**
- Сохранение истории работы агентов
- Возможность отслеживания изменений
- Лучший контроль действий агентов
- Возможность отката изменений при необходимости

## Примечания

- **Название файла:** АПИТАСК.MD (именно так, латиницей, как указано)
- **Местоположение:** `API-SWAGGER/АПИТАСК.MD`
- **Назначение:** Передача агенту инструкций для выполнения заданий (создания API спецификаций)
- **Использование:** Просто приложить этот файл и указать путь к заданию или сказать "делай API для всех заданий"
- **Архитектура:** Обязательно следовать структуре из `ARCHITECTURE.md`

---

## Полезные ссылки

- [OpenAPI Specification](https://swagger.io/specification/)
- [REST API Design](https://restfulapi.net/)
- [Swagger Editor](https://editor.swagger.io/)
- [Swagger Validator](https://validator.swagger.io/)

---

**Готов к работе! Пришли мне этот файл и путь к заданию - я создам API спецификацию.**

